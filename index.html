<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Page</title>
    <!-- Import des styles Ant Design -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/5.12.0/reset.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/5.12.0/antd.min.css">
    <style>
        :root {
            --primary-color: #6B4EFF;
            --border-radius: 8px;
            --background-color: #F5F5F5;
            --hover-color: #F5F3FF;
            --border-color: #f0f0f0;
            --text-secondary: #666;
            --primary-hover: #5B3EEF;
            --success-color: #52c41a;
            --error-color: #ff4d4f;
            --info-color: #1890ff;
            --accent-color: #722ed1;
            --warning-color: #faad14;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background-color);
        }
        
        .container {
            min-height: 100vh;
            display: flex;
        }
        
        .sidebar {
            width: 72px;
            background: white;
            border-right: 1px solid #f0f0f0;
            padding: 16px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .sidebar-item {
            width: 100%;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .sidebar-item:hover,
        .sidebar-item.active {
            color: var(--primary-color);
            background-color: var(--hover-color);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            font-weight: bold;
            font-size: 18px;
            margin-right: 24px;
            display: flex;
            align-items: center;
        }
        
        .logo img {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        
        .search-container {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .header-actions {
            display: flex;
            gap: 16px;
        }
        
        .breadcrumb {
            padding: 16px 24px;
            background: white;
            margin-bottom: 1px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .content-area {
            padding: 24px;
            padding-bottom: 80px; /* Add space for footer */
            flex: 1;
            background: var(--background-color);
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
            max-width: 100%;
        }
        
        .content-section {
            background: white;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: var(--border-radius);
            width: 100%;
            box-sizing: border-box;
        }
        
        .content-section-title {
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-icons span {
            margin-left: 8px;
            cursor: pointer;
            color: #666;
        }
        
        .action-icons span:hover {
            color: var(--primary-color);
        }
        
        .checklist-card {
            border: 1px solid #f0f0f0;
            border-radius: var(--border-radius);
            transition: all 0.3s;
        }
        
        .checklist-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Override Ant Design styles */
        .ant-tabs-tab.ant-tabs-tab-active .ant-tabs-tab-btn {
            color: var(--primary-color) !important;
        }
        
        .ant-tabs-ink-bar {
            background: var(--primary-color) !important;
        }

        .ant-btn-primary {
            background-color: var(--primary-color);
        }

        .ant-btn-primary:hover {
            background-color: #5B3EEF;
        }

        button {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        button.primary {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        button.primary:hover {
            background: var(--primary-hover);
        }

        .table {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .table th {
            background: var(--background-color);
            padding: 12px 16px;
            text-align: left;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .table tr:hover {
            background: var(--hover-color);
        }

        input[type="text"], 
        input[type="number"],
        select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            outline: none;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(107, 78, 255, 0.1);
        }

        .error-message {
            color: var(--error-color);
            font-size: 14px;
            margin-top: 4px;
        }

        .success-message {
            color: var(--success-color);
            font-size: 14px;
            margin-top: 4px;
        }

        .content-section-title .template-select {
            background: white;
        }

        .content-section-title .ant-select {
            margin-left: 16px;
        }

        .page-footer {
            position: fixed;
            bottom: 0;
            left: 72px;
            right: 0;
            background: white;
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            z-index: 1000;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }

        /* Ajout de styles pour le conteneur des formules */
        .formulas-container {
            display: flex;
            overflow-x: auto;
            padding: 8px 0;
            margin: 0;
            scrollbar-width: thin;
            scrollbar-color: rgba(0,0,0,0.2) transparent;
            -webkit-overflow-scrolling: touch;
            box-sizing: border-box;
            width: 100%;
        }

        .formulas-container::-webkit-scrollbar {
            height: 6px;
        }

        .formulas-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .formulas-container::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        /* Styles pour les résultats des formules */
        .formula-results {
            height: 320px;
            overflow-y: auto;
            padding: 12px;
            background: #fafafa;
            border-radius: 0 0 4px 4px;
            scrollbar-width: thin;
            scrollbar-color: rgba(0,0,0,0.2) transparent;
        }

        .formula-results::-webkit-scrollbar {
            width: 6px;
        }

        .formula-results::-webkit-scrollbar-track {
            background: transparent;
        }

        .formula-results::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        /* Styles pour les sections de résultats */
        .result-section {
            margin-bottom: 16px;
        }

        .result-section-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .metric-bar {
            margin-bottom: 12px;
            height: 52px;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        .metric-progress {
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            margin-bottom: 2px;
        }

        .metric-progress-bar {
            height: 100%;
            background: #1890ff;
            border-radius: 2px;
        }

        .metric-score {
            text-align: right;
            font-size: 0.8em;
            color: #666;
        }

        .content-section[type="no-action-style"] .ant-tabs-nav-list {
            opacity: 0;
        }

        .content-section[type="no-action-style"] .ant-tabs-tab {
            opacity: 1;
        }

        .template-select .ant-select-item-group {
            font-weight: bold;
            padding-left: 12px;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .template-select .ant-select-item-option-grouped {
            padding-left: 24px;
        }
        
        .template-select .ant-select-item-option {
            transition: all 0.3s;
        }
        
        .template-select .ant-select-item-option-active:not(.ant-select-item-option-disabled) {
            background-color: var(--hover-color);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Import des dépendances -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/dayjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/antd/5.12.0/antd.min.js"></script>

    <!-- Notre composant -->
    <script>
        const { 
            Layout, Card, Progress, Tag, Tooltip, Space, Collapse, Checkbox,
            Badge, Tabs, Row, Col, Statistic, Button, Drawer,
            Input, Form, Typography, Divider, Popover, Breadcrumb, Select, Dropdown, Menu, Modal
        } = antd;
        const { Header, Content, Sider } = Layout;
        const { Search, TextArea } = Input;
        const { Title } = Typography;

        // Données de test pour les guidelines
        const guidelines = {
            "Safety": "Les tests de sécurité doivent inclure:\n- Tests de résistance\n- Validation normative\n- Contrôles qualité",
            "Microbio": "Protocole de validation microbiologique:\n- Culture in vitro\n- Tests de contamination\n- Validation stabilité",
            "DG": "Processus de gestion des données:\n- Collecte\n- Analyse\n- Stockage sécurisé",
            "Pilote": "Organisation des tests pilotes:\n- Sélection site\n- Formation équipe\n- Suivi résultats",
            "Performance": "Critères de performance:\n- Temps de réponse\n- Précision\n- Reproductibilité"
        };

        const data = [
          { 
            title: "Safety", 
            validated: 3, 
            total: 5,
            color: "#ff4d4f",
            icon: "🔒",
            description: "Sécurité et conformité",
            subMilestones: [
                { id: "5DA", title: "5DA", status: "completed", description: "Documentation administrative" },
                { id: "AMM", title: "AMM", status: "pending", description: "Autorisation de mise sur le marché" },
                { id: "TESTS", title: "Tests sécurité", status: "in_progress", description: "Tests de sécurité produit" }
            ]
          },
          { 
            title: "Microbio", 
            validated: 5, 
            total: 5,
            color: "#52c41a",
            icon: "🔬",
            description: "Validation microbiologique",
            subMilestones: [
                { id: "CULT", title: "Culture", status: "completed", description: "Tests de culture in vitro" },
                { id: "CONT", title: "Contamination", status: "completed", description: "Tests de contamination" },
                { id: "STAB", title: "Stabilité", status: "completed", description: "Validation de la stabilité" }
            ]
          },
          { 
            title: "DG", 
            validated: 0, 
            total: 4,
            color: "#1890ff",
            icon: "📊",
            description: "Données et gestion",
            subMilestones: [
                { id: "COLL", title: "Collecte", status: "pending", description: "Collecte des données" },
                { id: "ANAL", title: "Analyse", status: "pending", description: "Analyse des résultats" },
                { id: "STOR", title: "Stockage", status: "pending", description: "Stockage sécurisé" }
            ]
          },
          { 
            title: "Pilote", 
            validated: 2, 
            total: 3,
            color: "#722ed1",
            icon: "✈️",
            description: "Tests pilotes",
            subMilestones: [
                { id: "SITE", title: "Site", status: "completed", description: "Sélection du site pilote" },
                { id: "FORM", title: "Formation", status: "completed", description: "Formation de l'équipe" },
                { id: "SUIV", title: "Suivi", status: "pending", description: "Suivi des résultats" }
            ]
          },
          { 
            title: "Performance", 
            validated: 1, 
            total: 4,
            color: "#faad14",
            icon: "⚡",
            description: "Tests de performance",
            subMilestones: [
                { id: "TEMP", title: "Temps", status: "completed", description: "Temps de réponse" },
                { id: "PREC", title: "Précision", status: "pending", description: "Tests de précision" },
                { id: "REPR", title: "Reproductibilité", status: "pending", description: "Tests de reproductibilité" }
            ]
          }
        ];

        const briefData = {
            performance: {
                title: "Performance",
                criteria: [
                    { name: "Color retention", target: "No fading", minScore: 3, maxScore: 4 },
                    { name: "Selectivity", target: "Highly selective", minScore: 3, maxScore: 4 }
                ]
            },
            security: {
                title: "Green & Sécurisation",
                criteria: [
                    { 
                        name: "Microplastique",
                        status: "mandatory",
                        description: "Éliminer les microplastiques de la formulation"
                    },
                    {
                        name: "Biodégradabilité",
                        status: "recommended",
                        description: "Assurer une biodégradabilité >90%"
                    }
                ]
            },
            cost: {
                title: "Objectifs de coût",
                criteria: [
                    {
                        name: "Prix formule",
                        target: "< 1.2€/kg",
                        current: "1.5€/kg"
                    }
                ]
            },
            color: {
                title: "Objectifs de couleur",
                targetShade: {
                    label: "3.5",
                    hex: "#363636",
                    colorSystem: "Origins Colorshot",
                    colorimetry: {
                        L: 24,
                        a: 1.32,
                        b: 2.92
                    }
                },
                referenceFormula: {
                    id: "ADJS190124", 
                    name: "Socle 508695 Color CP / Cocoon Bottle",
                    hex: "#363636"
                }
            }
        };

        const formulas = [
            { 
                id: "TSTRECOHYP4",
                iteration: 1,
                name: "Socle 508695 Color CP / Cocoon Bottle",
                status: "completed",
                version: "1+1.5",
                type: "initial",
                results: {
                    performance: [
                        { name: "Color retention", value: "Somewhat of fading", score: 3, total: 4 },
                        { name: "Selectivity", value: "Quite selective", score: 3, total: 4 }
                    ],
                    security: [
                        { name: "Microplastique", status: "non_compliant", value: "Présence" },
                        { name: "Biodégradabilité", status: "compliant", value: "92%" }
                    ],
                    cost: [
                        { name: "Prix formule", value: "1.8€/kg", status: "above_target" }
                    ],
                    color: {
                        targetShade: "3.5",
                        actualShade: "3.7",
                        status: "close",
                        colorimetry: {
                            L: 26.2,
                            a: 1.45,
                            b: 3.10
                        }
                    }
                },
                expertises: [
                    {
                        type: "Microbio",
                        status: "completed",
                        date: "12/03/2024",
                        expert: "Marie Dupont",
                        comment: "Les résultats sont conformes aux attentes. La sélectivité est particulièrement satisfaisante.",
                        requestId: "EXP-2024-001"
                    },
                    {
                        type: "Safety",
                        status: "in_progress",
                        date: "15/03/2024",
                        expert: "Jean Martin",
                        requestId: "EXP-2024-002"
                    }
                ]
            },
            { 
                id: "TSTADJHYP04",
                iteration: 2,
                name: "Socle 508695 Color CP / Cocoon Bottle",
                status: "in_progress",
                version: "1+1.5",
                type: "regular",
                results: {
                    performance: [
                        { name: "Color retention", value: "Somewhat of fading", score: 3, total: 4 },
                        { name: "Selectivity", value: "Quite selective", score: 3, total: 4 }
                    ],
                    security: [
                        { name: "Microplastique", status: "non_compliant", value: "Présence" },
                        { name: "Biodégradabilité", status: "compliant", value: "92%" }
                    ],
                    cost: [
                        { name: "Prix formule", value: "1.8€/kg", status: "above_target" }
                    ],
                    color: {
                        targetShade: "3.5",
                        actualShade: "3.9",
                        status: "off_target",
                        colorimetry: {
                            L: 28.5,
                            a: 1.62,
                            b: 3.25
                        }
                    }
                },
                expertises: []
            },
            { 
                id: "ADJS190124",
                iteration: 4,
                name: "Socle 508695 Color CP / Cocoon Bottle",
                status: "active",
                version: "1+1.5",
                type: "star",
                results: {
                    performance: [
                        { name: "Color retention", value: "Little fading", score: 2, total: 4 },
                        { name: "Selectivity", value: "Not very selective", score: 2, total: 4 }
                    ],
                    security: [
                        { name: "Microplastique", status: "non_compliant", value: "Présence" },
                        { name: "Biodégradabilité", status: "compliant", value: "92%" }
                    ],
                    cost: [
                        { name: "Prix formule", value: "1.8€/kg", status: "above_target" }
                    ],
                    color: {
                        targetShade: "3.5",
                        actualShade: "3.4",
                        status: "on_target",
                        colorimetry: {
                            L: 23.8,
                            a: 1.29,
                            b: 2.85
                        }
                    }
                },
                expertises: []
            }
        ];

        // Icônes du menu latéral
        const sidebarItems = [
            { icon: '⭐', label: 'Favoris' },
            { icon: '📋', label: 'Formula' },
            { icon: '📦', label: 'Product' },
            { icon: '🏭', label: 'Fab' },
            { icon: '🔬', label: 'Socle' },
            { icon: '📊', label: 'Off' },
            { icon: '📈', label: 'FI' },
            { icon: '🔧', label: 'Techno' },
            { icon: '⚗️', label: 'Ing' },
            { icon: '📑', label: 'Com. Ref.' },
            { icon: '🏢', label: 'Supplier' },
            { icon: '📝', label: 'RM Batch' },
            { icon: '🧪', label: 'Molecule' },
            { icon: '✓', label: 'Expertise' }
        ];

        function SidebarItem({ icon, label, active }) {
            return React.createElement('div', {
                className: `sidebar-item ${active ? 'active' : ''}`,
                title: label
            }, icon);
        }

        function MainHeader() {
            return React.createElement('div', {
                style: {
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    padding: '16px',
                    borderBottom: '1px solid #e8e8e8',
                    background: 'white'
                }
            },
                // Search section
                React.createElement('div', {
                    style: {
                        display: 'flex',
                        gap: '8px',
                        alignItems: 'center'
                    }
                },
                    React.createElement(Select, {
                        defaultValue: 'formula',
                        style: { width: 120 }
                    },
                        React.createElement(Select.Option, { value: 'formula' }, '🧪 Formula'),
                        React.createElement(Select.Option, { value: 'product' }, '📦 Product')
                    ),
                    React.createElement(Input.Search, {
                        placeholder: 'Rechercher...',
                        style: { width: 300 }
                    })
                ),
                // Project selector section and funding button
                React.createElement('div', {
                    style: {
                        display: 'flex',
                        gap: '16px',
                        alignItems: 'center'
                    }
                },
                    // Project selector
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            gap: '8px',
                            alignItems: 'center'
                        }
                    },
                        React.createElement('span', {
                            style: {
                                fontWeight: 500,
                                color: '#666'
                            }
                        }, 'Projet'),
                        React.createElement(Select, {
                            style: { width: 300 },
                            placeholder: 'Sélectionner un projet',
                            dropdownRender: (menu) => React.createElement(React.Fragment, null,
                                menu,
                                React.createElement(Divider, { style: { margin: '8px 0' } }),
                                React.createElement(Space, {
                                    style: {
                                        padding: '0 8px 4px'
                                    }
                                },
                                    React.createElement('span', {
                                        style: {
                                            color: '#666',
                                            cursor: 'pointer'
                                        }
                                    }, '⭐ Gérer mes projets favoris')
                                )
                            )
                        },
                            React.createElement(Select.Option, { value: 'cn-amelioration' }, 'Color Naturals - Amélioration formulation'),
                            React.createElement(Select.Option, { value: 'cn-securisation' }, 'Color Naturals - Sécurisation'),
                            React.createElement(Select.Option, { value: 'cn-cost' }, 'Color Naturals - Réduction coût')
                        ),
                        React.createElement(Button, {
                            type: 'text',
                            icon: '➡️',
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                padding: '4px 8px'
                            },
                            onClick: () => {
                                // Action pour accéder rapidement au projet
                                console.log('Quick access to project');
                            }
                        })
                    ),
                    // Funding button
                    React.createElement(Button, {
                        type: 'primary',
                        icon: '💰',
                        style: {
                            background: 'linear-gradient(135deg, #8C39FF, #FF6B3D)',
                            borderColor: 'transparent',
                            boxShadow: '0 2px 8px rgba(140, 57, 255, 0.3)',
                            fontWeight: 'bold',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                        },
                        onClick: () => {
                            window.location.href = 'funding.html';
                        }
                    }, 'Financer le projet')
                )
            );
        }

        function ProcessSteps() {
            return React.createElement('div', { className: 'steps-container' },
                React.createElement(Steps, {
                    current: 1,
                    items: processSteps
                })
            );
        }

        function ActionIcons({ item, onCommentClick }) {
            return React.createElement('span', { className: 'action-icons' },
                React.createElement(Popover, {
                    title: `Guidelines - ${item.title}`,
                    content: React.createElement('pre', null, guidelines[item.title]),
                    trigger: 'click'
                },
                    React.createElement('span', null, 'ℹ️')
                ),
                React.createElement('span', {
                    onClick: () => onCommentClick(item)
                }, '💬')
            );
        }

        function CommentDrawer({ visible, onClose, item, isPinning, onConfirm }) {
            const title = isPinning && item ? 
                `Définir cette formule comme formule de référence pour ${item.milestone}` :
                `Commentaires - ${item?.title || ''}`;

            return React.createElement(Drawer, {
                title: title,
                placement: 'right',
                onClose: onClose,
                open: visible,
                width: 400
            },
                React.createElement(Form, { layout: 'vertical' },
                    isPinning && React.createElement('div', {
                        style: {
                            padding: '12px',
                            background: '#f5f5f5',
                            borderRadius: '4px',
                            marginBottom: '16px'
                        }
                    },
                        React.createElement('div', { style: { fontWeight: 'bold' } },
                            `Formule : ${item?.id}`
                        ),
                        React.createElement('div', { style: { color: '#666', marginTop: '4px' } },
                            item?.name
                        )
                    ),
                    React.createElement(Form.Item, {
                        label: isPinning ? 'Commentaire de validation' : 'Nouveau commentaire'
                    },
                        React.createElement(TextArea, {
                            rows: 4,
                            placeholder: isPinning ? 
                                'Expliquez pourquoi cette formule est choisie comme référence...' :
                                'Ajoutez votre commentaire ici...'
                        })
                    ),
                    React.createElement('div', { 
                        style: {
                            position: 'absolute',
                            bottom: 0,
                            width: '100%',
                            borderTop: '1px solid #e8e8e8',
                            padding: '10px 16px',
                            textAlign: 'right',
                            left: 0,
                            background: '#fff'
                        }
                    },
                        React.createElement(Button, {
                            onClick: onClose,
                            style: { marginRight: 8 }
                        }, 'Annuler'),
                        React.createElement(Button, {
                            type: 'primary',
                            onClick: () => {
                                if (isPinning && onConfirm) {
                                    onConfirm();
                                }
                                onClose();
                            }
                        }, isPinning ? 'Confirmer' : 'Enregistrer')
                    )
                )
            );
        }

        function ChecklistCard({ item, onCommentClick, onItemClick, isSelected }) {
            const percent = Math.round((item.validated / item.total) * 100);
            const color = percent === 100 ? 'green' : percent > 0 ? 'orange' : 'red';
            
            return React.createElement(Col, { xs: 24, sm: 12, md: 8, lg: 6, key: item.title },
                React.createElement(Card, {
                    size: "small",
                    style: {
                        width: '100%',
                        borderTop: `3px solid ${item.color}`,
                        boxShadow: isSelected ? '0 0 0 2px var(--primary-color)' : 'none',
                        cursor: 'pointer',
                        transform: isSelected ? 'scale(1.02)' : 'none',
                        transition: 'all 0.3s ease'
                    },
                    onMouseEnter: (e) => {
                        e.currentTarget.style.transform = isSelected ? 'scale(1.02)' : 'translateY(-2px)';
                        e.currentTarget.style.boxShadow = isSelected ? 
                            '0 0 0 2px var(--primary-color), 0 4px 12px rgba(0,0,0,0.1)' : 
                            '0 4px 12px rgba(0,0,0,0.1)';
                    },
                    onMouseLeave: (e) => {
                        e.currentTarget.style.transform = isSelected ? 'scale(1.02)' : 'none';
                        e.currentTarget.style.boxShadow = isSelected ? 
                            '0 0 0 2px var(--primary-color)' : 
                            'none';
                    },
                    onClick: () => onItemClick(item)
                },
                    React.createElement(Space, { direction: "vertical", style: { width: '100%' } },
                        React.createElement(Space, null,
                            React.createElement('span', { style: { fontSize: '1.5em' } }, item.icon),
                            React.createElement('strong', null, item.title),
                            React.createElement(ActionIcons, { 
                                item: item,
                                onCommentClick: onCommentClick
                            })
                        ),
                        React.createElement('div', { 
                            style: { 
                                display: 'flex', 
                                justifyContent: 'space-between', 
                                alignItems: 'center',
                                marginBottom: '8px'
                            }
                        },
                        React.createElement(Tooltip, { title: `${item.validated} jalons sur ${item.total}` },
                            React.createElement(Tag, { color: color }, `${item.validated}/${item.total}`)
                            ),
                            item.conclusion && React.createElement(Tooltip, {
                                title: item.conclusion.comment
                            },
                                React.createElement(Tag, {
                                    color: item.conclusion.status === 'OK' ? 'success' :
                                           item.conclusion.status === 'KO' ? 'error' :
                                           'warning'
                                }, item.conclusion.status)
                            )
                        ),
                        React.createElement(Progress, {
                            percent: percent,
                            strokeColor: item.color,
                            format: percent => `${percent}%`
                        }),
                        React.createElement('div', { style: { fontSize: '0.8em', color: '#666' } },
                            item.description
                        ),
                        isSelected && React.createElement('div', {
                            style: {
                                position: 'absolute',
                                bottom: '-12px',
                                left: '50%',
                                transform: 'translateX(-50%)',
                                width: '24px',
                                height: '24px',
                                background: 'white',
                                border: '2px solid var(--primary-color)',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'var(--primary-color)',
                                fontSize: '12px'
                            }
                        }, '▼')
                    )
                )
            );
        }

        function ContentSection({ title, children, action, type }) {
            return React.createElement('div', { className: 'content-section' },
                React.createElement('div', { className: 'content-section-title' },
                    React.createElement(Title, { level: 4 }, title),
                    typeof action === 'string' ? 
                        React.createElement(Button, { type: 'primary' }, action) :
                        action
                ),
                children
            );
        }

        function ChecklistView({ data, onCommentClick, onItemClick, selectedItem }) {
            return React.createElement(Row, { gutter: [16, 16] },
                data.map(item => 
                    React.createElement(ChecklistCard, {
                        key: item.title,
                        item: item,
                        onCommentClick: onCommentClick,
                        onItemClick: onItemClick,
                        isSelected: selectedItem?.title === item.title
                    })
                )
            );
        }

        function StatisticsView({ data }) {
            return React.createElement(Row, { gutter: [16, 16] },
                data.map(item => {
                    const percent = Math.round((item.validated / item.total) * 100);
                    return React.createElement(Col, { xs: 24, sm: 12, md: 8, lg: 6, key: item.title },
                        React.createElement(Card, { size: "small" },
                            React.createElement(Statistic, {
                                title: item.title,
                                value: percent,
                                suffix: "%",
                                valueStyle: { color: item.color },
                                prefix: item.icon
                            }),
                            React.createElement('div', { style: { marginTop: 8 } },
                                React.createElement(Progress, {
                                    percent: percent,
                                    size: "small",
                                    strokeColor: item.color,
                                    showInfo: false
                                })
                            )
                        )
                    );
                })
            );
        }

        function BadgesView({ data }) {
            return React.createElement(Space, { direction: "vertical", style: { width: '100%' } },
                data.map(item => {
                    const percent = item.validated / item.total;
                    const status = percent === 1 ? 'success' : percent > 0 ? 'warning' : 'error';
                    return React.createElement(Tooltip, {
                        title: `${item.validated}/${item.total} jalons validés - ${item.description}`,
                        key: item.title
                    },
                        React.createElement(Badge, {
                            status: status,
                            text: React.createElement(Space, null,
                                item.icon,
                                React.createElement('span', null, item.title),
                                React.createElement(Tag, { color: item.color }, `${item.validated}/${item.total}`)
                            )
                        })
                    );
                })
            );
        }

        function SubMilestoneCard({ milestone, onCommentClick }) {
            const statusColors = {
                completed: "var(--success-color)",
                pending: "var(--warning-color)",
                in_progress: "var(--primary-color)"
            };
            
            return React.createElement(Card, {
                size: "small",
                style: {
                    width: '100%',
                    marginBottom: '12px',
                    borderLeft: `3px solid ${statusColors[milestone.status]}`
                }
            },
                React.createElement(Space, { direction: "vertical", style: { width: '100%' } },
                    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' } },
                        React.createElement('strong', null, milestone.title),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px'
                            }
                        },
                            React.createElement(Button, {
                                type: 'text',
                                size: 'small',
                                icon: '💬',
                                onClick: (e) => {
                                    e.stopPropagation();
                                    onCommentClick && onCommentClick({
                                        title: `${milestone.title} - Sous-jalon`,
                                        comment: milestone.comment
                                    });
                                }
                            }),
                        React.createElement(Tag, { color: statusColors[milestone.status] },
                            milestone.status === 'completed' ? '✓ Complété' :
                            milestone.status === 'in_progress' ? '⏳ En cours' : '⏸ En attente'
                            )
                        )
                    ),
                    React.createElement('div', { style: { fontSize: '0.9em', color: '#666' } },
                        milestone.description
                    ),
                    React.createElement('div', {
                        style: {
                            marginTop: '8px',
                            padding: '8px',
                            background: '#f0f7ff',
                            border: '1px solid #91caff',
                            borderRadius: '4px',
                            fontSize: '0.9em'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px'
                            }
                        },
                            React.createElement('span', null, '📌 Formule de référence:'),
                            React.createElement(Button, {
                                type: 'link',
                                size: 'small',
                                onClick: () => console.log(`Navigate to formula ${milestone.id}`)
                            }, 
                                `${milestone.id} - ${milestone.name}`
                            )
                        )
                    ),
                    milestone.status === 'completed' && React.createElement('div', { 
                        style: { 
                            marginTop: '8px',
                            padding: '8px',
                            background: '#f6ffed',
                            border: '1px solid #b7eb8f',
                            borderRadius: '4px',
                            fontSize: '0.9em'
                        }
                    },
                        React.createElement('div', { 
                            style: { 
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                marginBottom: '4px'
                            }
                        },
                            React.createElement('span', { 
                                style: { fontWeight: 'bold' }
                            }, '✓ Validé par Expert'),
                            React.createElement('span', { 
                                style: { color: '#666', fontSize: '0.9em' }
                            }, '12/03/2024')
                        ),
                        React.createElement('div', { style: { marginBottom: '8px' } },
                            '"Les résultats sont conformes aux attentes. La sélectivité est particulièrement satisfaisante."'
                        ),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                gap: '16px'
                            }
                        },
                            React.createElement(Button, {
                                type: 'link',
                                size: 'small',
                                icon: '📄',
                                onClick: () => window.location.href = '/expertise-request'
                            }, 'Voir la demande d\'expertise'),
                            React.createElement(Button, {
                                type: 'link',
                                size: 'small',
                                icon: '📊',
                                onClick: () => window.location.href = 'https://powerbi.com/expertise-results'
                            }, 'Résultats')
                        )
                    ),
                    // Commentaires utilisateurs
                    React.createElement('div', {
                        style: {
                            marginTop: '8px',
                            padding: '8px',
                            background: '#f0f7ff',
                            border: '1px solid #91caff',
                            borderRadius: '4px',
                            fontSize: '0.9em'
                        }
                    },
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '8px',
                                    alignItems: 'flex-start'
                                }
                            },
                            React.createElement('span', null, '💬'),
                                React.createElement('div', null,
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            color: '#666',
                                            fontSize: '0.9em',
                                            marginBottom: '4px'
                                        }
                                    },
                                    React.createElement('span', null, 'Marie Dupont'),
                                    React.createElement('span', null, '10/03/2024')
                                ),
                                React.createElement('div', null, 'Tests de culture in vitro réalisés avec succès. Résultats conformes aux attentes avec une sélectivité particulièrement satisfaisante.')
                            )
                        )
                    )
                )
            );
        }

        function ConcludeExpertiseDrawer({ visible, onClose, milestone, onSubmit }) {
            const [conclusion, setConclusion] = React.useState('');
            const [status, setStatus] = React.useState('');
            const [comment, setComment] = React.useState('');

            const handleSubmit = () => {
                // Here you would handle the submission of the conclusion
                console.log('Submitting conclusion:', { status, comment });
                onClose();
                onSubmit({ status, comment });
            };

            return React.createElement(Drawer, {
                title: 'Conclure pour mon projet sur la microbio',
                placement: 'right',
                onClose: onClose,
                open: visible,
                width: 520,
                footer: React.createElement('div', {
                    style: {
                        display: 'flex',
                        justifyContent: 'flex-end',
                        gap: '8px'
                    }
                },
                    React.createElement(Button, {
                        onClick: onClose
                    }, 'Annuler'),
                    React.createElement(Button, {
                        type: 'primary',
                        onClick: handleSubmit,
                        disabled: !status || !comment
                    }, 'Enregistrer')
                )
            },
                React.createElement('div', {
                    style: {
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '16px'
                    }
                },
                    React.createElement('div', null,
                        React.createElement('div', {
                            style: { marginBottom: '8px', fontWeight: 'bold' }
                        }, 'Statut'),
                        React.createElement(Space, {
                            direction: 'vertical',
                            style: { width: '100%' }
                        },
                            React.createElement(Button, {
                                type: status === 'OK' ? 'primary' : 'default',
                                onClick: () => setStatus('OK'),
                                style: { width: '100%' }
                            }, 'OK'),
                            React.createElement(Button, {
                                type: status === 'KO' ? 'primary' : 'default',
                                onClick: () => setStatus('KO'),
                                danger: status === 'KO',
                                style: { width: '100%' }
                            }, 'KO'),
                            React.createElement(Button, {
                                type: status === 'A risque' ? 'primary' : 'default',
                                onClick: () => setStatus('A risque'),
                                style: { 
                                    width: '100%',
                                    ...(status === 'A risque' ? { 
                                        backgroundColor: '#faad14',
                                        borderColor: '#faad14'
                                    } : {})
                                }
                            }, 'A risque')
                        )
                    ),
                    React.createElement('div', null,
                        React.createElement('div', {
                            style: { marginBottom: '8px', fontWeight: 'bold' }
                        }, 'Commentaire'),
                        React.createElement(Input.TextArea, {
                            value: comment,
                            onChange: (e) => setComment(e.target.value),
                            placeholder: 'Ajouter un commentaire...',
                            rows: 4
                        })
                    )
                )
            );
        }

        function BriefContent() {
            const renderPerformanceTab = (data) => {
                return React.createElement('div', { style: { padding: '16px 0' } },
                    React.createElement('div', {
                        style: {
                            marginBottom: '24px',
                            padding: '12px 16px',
                            background: '#f9f9f9',
                            borderRadius: '6px',
                            border: '1px dashed #d9d9d9'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                marginBottom: '8px'
                            }
                        },
                            React.createElement('span', {
                                style: {
                                    fontWeight: 'bold',
                                    color: '#666'
                                }
                            }, 'Liens vers les outils couleur'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '8px'
                                }
                            },
                                React.createElement('a', {
                                    href: '#color',
                                    onClick: (e) => {
                                        e.preventDefault();
                                        document.querySelector('[data-node-key="color"]').click();
                                    },
                                    style: {
                                        color: '#1890ff',
                                        fontSize: '14px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        background: '#f0f7ff',
                                        padding: '4px 8px',
                                        borderRadius: '4px'
                                    }
                                }, 
                                    '🎨 Détails couleur'
                                ),
                                React.createElement('a', {
                                    href: '#',
                                    onClick: (e) => {
                                        e.preventDefault();
                                        // Simuler l'ouverture de SCC sur mèches
                                        Modal.info({
                                            title: 'SCC - Visualisation sur mèches de cheveux',
                                            width: 800,
                                            content: React.createElement('div', null,
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'flex',
                                                        gap: '16px',
                                                        marginBottom: '20px'
                                                    }
                                                },
                                                    // Visualisation de la mèche principale
                                                    React.createElement('div', {
                                                        style: {
                                                            flex: 1,
                                                        }
                                                    },
                                                        React.createElement('div', {
                                                            style: {
                                                                fontSize: '14px',
                                                                fontWeight: 'bold',
                                                                marginBottom: '8px'
                                                            }
                                                        }, 'Nuance 3.5 - Origins Colorshot'),
                                                        React.createElement('div', {
                                                            style: {
                                                                width: '100%',
                                                                height: '350px',
                                                                backgroundImage: 'linear-gradient(180deg, #363636 0%, #4a4a4a 40%, #5a5a5a 70%, #6d6d6d 100%)',
                                                                borderRadius: '8px',
                                                                position: 'relative',
                                                                overflow: 'hidden'
                                                            }
                                                        },
                                                            // Effet de mèche de cheveux
                                                            Array.from({ length: 40 }, (_, i) => {
                                                                return React.createElement('div', {
                                                                    key: i,
                                                                    style: {
                                                                        position: 'absolute',
                                                                        width: `${2 + Math.random() * 3}px`,
                                                                        height: `${200 + Math.random() * 150}px`,
                                                                        left: `${i * 2.5 + Math.random() * 5}%`,
                                                                        top: 0,
                                                                        backgroundImage: 'linear-gradient(180deg, #363636 0%, #4a4a4a 40%, #5a5a5a 70%, #6d6d6d 100%)',
                                                                        transform: `rotate(${Math.random() * 6 - 3}deg)`,
                                                                        boxShadow: '0 0 2px rgba(0,0,0,0.3)',
                                                                        borderRadius: '50%/10%'
                                                                    }
                                                                });
                                                            })
                                                        )
                                                    ),
                                                    // Comparaison avec autres nuances
                                                    React.createElement('div', {
                                                        style: {
                                                            flex: 1,
                                                            display: 'flex',
                                                            flexDirection: 'column',
                                                            gap: '16px'
                                                        }
                                                    },
                                                        [
                                                            { label: '3.0', gradient: 'linear-gradient(180deg, #2a2a2a 0%, #3a3a3a 40%, #4a4a4a 70%, #5a5a5a 100%)' },
                                                            { label: '4.0', gradient: 'linear-gradient(180deg, #454545 0%, #555555 40%, #656565 70%, #757575 100%)' },
                                                            { label: '5.0', gradient: 'linear-gradient(180deg, #565656 0%, #656565 40%, #757575 70%, #858585 100%)' }
                                                        ].map((item, idx) => (
                                                            React.createElement('div', { 
                                                                key: idx,
                                                                style: {
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    gap: '12px'
                                                                }
                                                            },
                                                                React.createElement('div', {
                                                                    style: {
                                                                        width: '100px',
                                                                        height: '100px',
                                                                        backgroundImage: item.gradient,
                                                                        borderRadius: '8px',
                                                                        position: 'relative',
                                                                        overflow: 'hidden'
                                                                    }
                                                                },
                                                                    // Mini-effet de mèche
                                                                    Array.from({ length: 10 }, (_, i) => {
                                                                        return React.createElement('div', {
                                                                            key: i,
                                                                            style: {
                                                                                position: 'absolute',
                                                                                width: `${1 + Math.random() * 2}px`,
                                                                                height: `${70 + Math.random() * 30}px`,
                                                                                left: `${i * 10 + Math.random() * 5}%`,
                                                                                top: 0,
                                                                                backgroundImage: item.gradient,
                                                                                transform: `rotate(${Math.random() * 6 - 3}deg)`,
                                                                                boxShadow: '0 0 1px rgba(0,0,0,0.2)',
                                                                                borderRadius: '50%/10%'
                                                                            }
                                                                        });
                                                                    })
                                                                ),
                                                                React.createElement('div', null,
                                                                    React.createElement('div', {
                                                                        style: {
                                                                            fontWeight: 'bold'
                                                                        }
                                                                    }, `Nuance ${item.label}`),
                                                                    React.createElement('div', {
                                                                        style: {
                                                                            fontSize: '12px',
                                                                            color: '#666'
                                                                        }
                                                                    }, 'Origins Colorshot')
                                                                )
                                                            )
                                                        ))
                                                    )
                                                ),
                                                React.createElement('div', {
                                                    style: {
                                                        borderTop: '1px solid #f0f0f0',
                                                        marginTop: '16px',
                                                        paddingTop: '16px'
                                                    }
                                                },
                                                    React.createElement('div', {
                                                        style: {
                                                            fontSize: '14px',
                                                            fontWeight: 'bold',
                                                            marginBottom: '8px'
                                                        }
                                                    }, 'Informations colorimétriques'),
                                                    React.createElement('div', {
                                                        style: {
                                                            display: 'flex',
                                                            gap: '16px'
                                                        }
                                                    },
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'L: '),
                                                            briefData.color.targetShade.colorimetry.L
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'a: '),
                                                            briefData.color.targetShade.colorimetry.a
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'b: '),
                                                            briefData.color.targetShade.colorimetry.b
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'HEX: '),
                                                            briefData.color.targetShade.hex
                                                        )
                                                    )
                                                )
                                            )
                                        });
                                    },
                                    style: {
                                        color: '#1890ff',
                                        fontSize: '14px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        background: '#f0f7ff',
                                        padding: '4px 8px',
                                        borderRadius: '4px'
                                    }
                                }, 
                                    '💇 SCC Mèches'
                                ),
                                React.createElement('a', {
                                    href: '#',
                                    onClick: (e) => {
                                        e.preventDefault();
                                        // Simuler l'ouverture de SCC ColorViz
                                        Modal.info({
                                            title: 'SCC ColorViz',
                                            width: 700,
                                            content: React.createElement('div', null,
                                                React.createElement('p', {
                                                    style: { marginBottom: '16px' }
                                                }, "Exploration de couleurs similaires dans la palette SCC ColorViz"),
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'grid',
                                                        gridTemplateColumns: 'repeat(5, 1fr)',
                                                        gap: '12px',
                                                        marginBottom: '20px'
                                                    }
                                                },
                                                    // Génération d'une palette de couleurs similaires au format Pinterest
                                                    Array.from({ length: 20 }, (_, i) => {
                                                        // Créer des variations de la couleur cible
                                                        const variationFactor = (i % 5 - 2) * 0.1;
                                                        const l = Math.max(0, Math.min(100, 24 + variationFactor * 15));
                                                        const a = Math.max(-128, Math.min(127, 1.32 + variationFactor * 2));
                                                        const b = Math.max(-128, Math.min(127, 2.92 + variationFactor * 3));
                                                        
                                                        // Fonction simplifiée pour convertir LAB approximatif en hex
                                                        const labToHex = (l, a, b) => {
                                                            const brightness = Math.round((l / 100) * 255);
                                                            const redShift = Math.round(a * 2);
                                                            const blueShift = Math.round(b * 2);
                                                            
                                                            const r = Math.max(0, Math.min(255, brightness + redShift));
                                                            const g = Math.max(0, Math.min(255, brightness));
                                                            const bl = Math.max(0, Math.min(255, brightness + blueShift));
                                                            
                                                            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${bl.toString(16).padStart(2, '0')}`;
                                                        };
                                                        
                                                        const shade = (3.5 + (i % 5 - 2) * 0.2).toFixed(1);
                                                        const hexColor = labToHex(l, a, b);
                                                        
                                                        return React.createElement('div', {
                                                            key: i,
                                                            style: {
                                                                display: 'flex',
                                                                flexDirection: 'column',
                                                                alignItems: 'center',
                                                                cursor: 'pointer'
                                                            },
                                                            onClick: () => Modal.info({ 
                                                                title: `Sélection de la nuance ${shade}`,
                                                                content: `La nuance ${shade} a été sélectionnée comme nouvelle couleur cible.`
                                                            })
                                                        },
                                                            React.createElement('div', {
                                                                style: {
                                                                    width: '100%',
                                                                    paddingBottom: '100%',
                                                                    borderRadius: '4px',
                                                                    backgroundColor: hexColor,
                                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
                                                                    marginBottom: '6px',
                                                                    border: '1px solid #e8e8e8'
                                                                }
                                                            }),
                                                            React.createElement('span', {
                                                                style: { fontSize: '12px' }
                                                            }, shade)
                                                        );
                                                    })
                                                ),
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'flex',
                                                        justifyContent: 'flex-end',
                                                        gap: '8px'
                                                    }
                                                },
                                                    React.createElement(Button, null, 'Annuler'),
                                                    React.createElement(Button, {
                                                        type: 'primary'
                                                    }, 'Appliquer')
                                                )
                                            )
                                        });
                                    },
                                    style: {
                                        color: '#1890ff',
                                        fontSize: '14px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        background: '#f0f7ff',
                                        padding: '4px 8px',
                                        borderRadius: '4px'
                                    }
                                }, 
                                    '🎨 SCC ColorViz'
                                )
                            )
                        )
                    ),
                    // Original performance criteria content
                    data.criteria.map((criterion, index) =>
                        React.createElement('div', { 
                            key: index,
                            style: { marginBottom: '16px' }
                        },
                            React.createElement('div', { 
                                style: { 
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    marginBottom: '4px'
                                }
                            },
                                React.createElement('strong', null, criterion.name)
                            ),
                            React.createElement('div', { 
                                style: { 
                                    color: '#666',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '16px'
                                }
                            },
                                React.createElement('span', null, `Objectif: ${criterion.target}`),
                                React.createElement(Tag, { color: 'blue' }, 
                                    `Score minimum: ${criterion.minScore}/${criterion.maxScore}`
                                )
                            )
                        )
                    )
                );
            };

            const renderSecurityTab = (data) => {
                return React.createElement('div', { style: { padding: '16px 0' } },
                    data.criteria.map((criterion, index) =>
                        React.createElement('div', { 
                            key: index,
                            style: { marginBottom: '16px' }
                        },
                            React.createElement('div', { 
                                style: { 
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    marginBottom: '4px'
                                }
                            },
                                React.createElement('strong', null, criterion.name),
                                React.createElement(Tag, {
                                    color: criterion.status === 'mandatory' ? 'red' : 'blue'
                                }, criterion.status === 'mandatory' ? 'Obligatoire' : 'Recommandé')
                            ),
                            React.createElement('div', { 
                                style: { color: '#666' }
                            }, criterion.description)
                        )
                    )
                );
            };

            const renderCostTab = (data) => {
                return React.createElement('div', { style: { padding: '16px 0' } },
                    data.criteria.map((criterion, index) =>
                        React.createElement('div', { 
                            key: index,
                            style: { marginBottom: '16px' }
                        },
                            React.createElement('div', { 
                                style: { 
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    marginBottom: '4px'
                                }
                            },
                                React.createElement('strong', null, criterion.name)
                            ),
                            React.createElement('div', { 
                                style: { 
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '16px'
                                }
                            },
                                React.createElement(Tag, { color: 'gold' }, `Objectif: ${criterion.target}`),
                                React.createElement(Tag, { color: 'blue' }, `Actuel: ${criterion.current}`)
                            )
                        )
                    )
                );
            };

            const renderColorTab = (data) => {
                return React.createElement('div', { style: { padding: '16px 0' } },
                    React.createElement('div', { 
                        style: { 
                            marginBottom: '24px',
                            borderRadius: '8px',
                            border: '1px solid #e8e8e8',
                            padding: '16px',
                            background: '#fafafa'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                fontWeight: 'bold',
                                marginBottom: '12px',
                                fontSize: '16px',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center'
                            }
                        }, 
                            React.createElement('span', null, 'Target shade'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '8px'
                                }
                            },
                                React.createElement('a', {
                                    href: '#',
                                    onClick: (e) => {
                                        e.preventDefault();
                                        // Simuler l'ouverture de SCC sur mèches
                                        Modal.info({
                                            title: 'SCC - Visualisation sur mèches de cheveux',
                                            width: 800,
                                            content: React.createElement('div', null,
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'flex',
                                                        gap: '16px',
                                                        marginBottom: '20px'
                                                    }
                                                },
                                                    // Visualisation de la mèche principale
                                                    React.createElement('div', {
                                                        style: {
                                                            flex: 1,
                                                        }
                                                    },
                                                        React.createElement('div', {
                                                            style: {
                                                                fontSize: '14px',
                                                                fontWeight: 'bold',
                                                                marginBottom: '8px'
                                                            }
                                                        }, 'Nuance 3.5 - Origins Colorshot'),
                                                        React.createElement('div', {
                                                            style: {
                                                                width: '100%',
                                                                height: '350px',
                                                                backgroundImage: 'linear-gradient(180deg, #363636 0%, #4a4a4a 40%, #5a5a5a 70%, #6d6d6d 100%)',
                                                                borderRadius: '8px',
                                                                position: 'relative',
                                                                overflow: 'hidden'
                                                            }
                                                        },
                                                            // Effet de mèche de cheveux
                                                            Array.from({ length: 40 }, (_, i) => {
                                                                return React.createElement('div', {
                                                                    key: i,
                                                                    style: {
                                                                        position: 'absolute',
                                                                        width: `${2 + Math.random() * 3}px`,
                                                                        height: `${200 + Math.random() * 150}px`,
                                                                        left: `${i * 2.5 + Math.random() * 5}%`,
                                                                        top: 0,
                                                                        backgroundImage: 'linear-gradient(180deg, #363636 0%, #4a4a4a 40%, #5a5a5a 70%, #6d6d6d 100%)',
                                                                        transform: `rotate(${Math.random() * 6 - 3}deg)`,
                                                                        boxShadow: '0 0 2px rgba(0,0,0,0.3)',
                                                                        borderRadius: '50%/10%'
                                                                    }
                                                                });
                                                            })
                                                        )
                                                    ),
                                                    // Comparaison avec autres nuances
                                                    React.createElement('div', {
                                                        style: {
                                                            flex: 1,
                                                            display: 'flex',
                                                            flexDirection: 'column',
                                                            gap: '16px'
                                                        }
                                                    },
                                                        [
                                                            { label: '3.0', gradient: 'linear-gradient(180deg, #2a2a2a 0%, #3a3a3a 40%, #4a4a4a 70%, #5a5a5a 100%)' },
                                                            { label: '4.0', gradient: 'linear-gradient(180deg, #454545 0%, #555555 40%, #656565 70%, #757575 100%)' },
                                                            { label: '5.0', gradient: 'linear-gradient(180deg, #565656 0%, #656565 40%, #757575 70%, #858585 100%)' }
                                                        ].map((item, idx) => (
                                                            React.createElement('div', { 
                                                                key: idx,
                                                                style: {
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    gap: '12px'
                                                                }
                                                            },
                                                                React.createElement('div', {
                                                                    style: {
                                                                        width: '100px',
                                                                        height: '100px',
                                                                        backgroundImage: item.gradient,
                                                                        borderRadius: '8px',
                                                                        position: 'relative',
                                                                        overflow: 'hidden'
                                                                    }
                                                                },
                                                                    // Mini-effet de mèche
                                                                    Array.from({ length: 10 }, (_, i) => {
                                                                        return React.createElement('div', {
                                                                            key: i,
                                                                            style: {
                                                                                position: 'absolute',
                                                                                width: `${1 + Math.random() * 2}px`,
                                                                                height: `${70 + Math.random() * 30}px`,
                                                                                left: `${i * 10 + Math.random() * 5}%`,
                                                                                top: 0,
                                                                                backgroundImage: item.gradient,
                                                                                transform: `rotate(${Math.random() * 6 - 3}deg)`,
                                                                                boxShadow: '0 0 1px rgba(0,0,0,0.2)',
                                                                                borderRadius: '50%/10%'
                                                                            }
                                                                        });
                                                                    })
                                                                ),
                                                                React.createElement('div', null,
                                                                    React.createElement('div', {
                                                                        style: {
                                                                            fontWeight: 'bold'
                                                                        }
                                                                    }, `Nuance ${item.label}`),
                                                                    React.createElement('div', {
                                                                        style: {
                                                                            fontSize: '12px',
                                                                            color: '#666'
                                                                        }
                                                                    }, 'Origins Colorshot')
                                                                )
                                                            )
                                                        ))
                                                    )
                                                ),
                                                React.createElement('div', {
                                                    style: {
                                                        borderTop: '1px solid #f0f0f0',
                                                        marginTop: '16px',
                                                        paddingTop: '16px'
                                                    }
                                                },
                                                    React.createElement('div', {
                                                        style: {
                                                            fontSize: '14px',
                                                            fontWeight: 'bold',
                                                            marginBottom: '8px'
                                                        }
                                                    }, 'Informations colorimétriques'),
                                                    React.createElement('div', {
                                                        style: {
                                                            display: 'flex',
                                                            gap: '16px'
                                                        }
                                                    },
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'L: '),
                                                            data.targetShade.colorimetry.L
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'a: '),
                                                            data.targetShade.colorimetry.a
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'b: '),
                                                            data.targetShade.colorimetry.b
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('span', {
                                                                style: { fontWeight: 'bold' }
                                                            }, 'HEX: '),
                                                            data.targetShade.hex
                                                        )
                                                    )
                                                )
                                            )
                                        });
                                    },
                                    style: {
                                        color: '#1890ff',
                                        fontSize: '14px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        background: '#f0f7ff',
                                        padding: '4px 8px',
                                        borderRadius: '4px'
                                    }
                                }, 
                                    '💇 SCC Mèches'
                                ),
                                React.createElement('a', {
                                    href: '#',
                                    onClick: (e) => {
                                        e.preventDefault();
                                        // Simuler l'ouverture de SCC ColorViz
                                        Modal.info({
                                            title: 'SCC ColorViz',
                                            width: 700,
                                            content: React.createElement('div', null,
                                                React.createElement('p', {
                                                    style: { marginBottom: '16px' }
                                                }, "Exploration de couleurs similaires dans la palette SCC ColorViz"),
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'grid',
                                                        gridTemplateColumns: 'repeat(5, 1fr)',
                                                        gap: '12px',
                                                        marginBottom: '20px'
                                                    }
                                                },
                                                    // Génération d'une palette de couleurs similaires au format Pinterest
                                                    Array.from({ length: 20 }, (_, i) => {
                                                        // Créer des variations de la couleur cible
                                                        const variationFactor = (i % 5 - 2) * 0.1;
                                                        const l = Math.max(0, Math.min(100, 24 + variationFactor * 15));
                                                        const a = Math.max(-128, Math.min(127, 1.32 + variationFactor * 2));
                                                        const b = Math.max(-128, Math.min(127, 2.92 + variationFactor * 3));
                                                        
                                                        // Fonction simplifiée pour convertir LAB approximatif en hex (approximation grossière)
                                                        const labToHex = (l, a, b) => {
                                                            const brightness = Math.round((l / 100) * 255);
                                                            const redShift = Math.round(a * 2);
                                                            const blueShift = Math.round(b * 2);
                                                            
                                                            const r = Math.max(0, Math.min(255, brightness + redShift));
                                                            const g = Math.max(0, Math.min(255, brightness));
                                                            const bl = Math.max(0, Math.min(255, brightness + blueShift));
                                                            
                                                            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${bl.toString(16).padStart(2, '0')}`;
                                                        };
                                                        
                                                        const shade = (3.5 + (i % 5 - 2) * 0.2).toFixed(1);
                                                        const hexColor = labToHex(l, a, b);
                                                        
                                                        return React.createElement('div', {
                                                            key: i,
                                                            style: {
                                                                display: 'flex',
                                                                flexDirection: 'column',
                                                                alignItems: 'center',
                                                                cursor: 'pointer'
                                                            },
                                                            onClick: () => Modal.info({ 
                                                                title: `Sélection de la nuance ${shade}`,
                                                                content: `La nuance ${shade} a été sélectionnée comme nouvelle couleur cible.`
                                                            })
                                                        },
                                                            React.createElement('div', {
                                                                style: {
                                                                    width: '100%',
                                                                    paddingBottom: '100%',
                                                                    borderRadius: '4px',
                                                                    backgroundColor: hexColor,
                                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
                                                                    marginBottom: '6px',
                                                                    border: '1px solid #e8e8e8'
                                                                }
                                                            }),
                                                            React.createElement('span', {
                                                                style: { fontSize: '12px' }
                                                            }, shade)
                                                        );
                                                    })
                                                ),
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'flex',
                                                        justifyContent: 'flex-end',
                                                        gap: '8px'
                                                    }
                                                },
                                                    React.createElement(Button, null, 'Annuler'),
                                                    React.createElement(Button, {
                                                        type: 'primary'
                                                    }, 'Appliquer')
                                                )
                                            )
                                        });
                                    },
                                    style: {
                                        color: '#1890ff',
                                        fontSize: '14px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        background: '#f0f7ff',
                                        padding: '4px 8px',
                                        borderRadius: '4px'
                                    }
                                }, 
                                    '🎨 SCC ColorViz'
                                )
                            )
                        ),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'flex-start',
                                gap: '20px'
                            }
                        },
                            // Color swatch
                            React.createElement('div', {
                                style: {
                                    width: '100px',
                                    height: '80px',
                                    backgroundColor: data.targetShade.hex,
                                    borderRadius: '4px',
                                    boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                }
                            }),
                            // Color info
                            React.createElement('div', {
                                style: {
                                    flex: 1
                                }
                            },
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        alignItems: 'baseline',
                                        marginBottom: '8px'
                                    }
                                },
                                    React.createElement('span', {
                                        style: {
                                            fontSize: '24px',
                                            fontWeight: 'bold',
                                            marginRight: '12px'
                                        }
                                    }, data.targetShade.label)
                                ),
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        flexDirection: 'column',
                                        gap: '4px'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            fontSize: '13px',
                                            color: '#666'
                                        }
                                    }, `${data.targetShade.colorSystem}`),
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            gap: '16px',
                                            fontSize: '13px',
                                            color: '#666'
                                        }
                                    },
                                        React.createElement('span', null, `L: ${data.targetShade.colorimetry.L}`),
                                        React.createElement('span', null, `a: ${data.targetShade.colorimetry.a}`),
                                        React.createElement('span', null, `b: ${data.targetShade.colorimetry.b}`)
                                    )
                                )
                            ),
                            // Buttons
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '8px'
                                }
                            },
                                React.createElement(Button, {
                                    type: 'default',
                                    size: 'small'
                                }, 'DN'),
                                React.createElement(Button, {
                                    type: 'default',
                                    size: 'small'
                                }, 'DP')
                            )
                        )
                    ),
                    // Ajouter la formule de référence couleur si elle existe
                    data.referenceFormula && React.createElement('div', {
                        style: {
                            marginBottom: '24px',
                            borderRadius: '8px', 
                            border: '1px solid #e8e8e8',
                            padding: '16px',
                            background: 'white'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                fontWeight: 'bold',
                                marginBottom: '12px',
                                fontSize: '16px'
                            }
                        }, 'Formule de référence couleur'),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                gap: '16px',
                                alignItems: 'center'
                            }
                        },
                            // Couleur de la formule
                            React.createElement('div', {
                                style: {
                                    width: '40px',
                                    height: '40px',
                                    backgroundColor: data.referenceFormula.hex,
                                    borderRadius: '4px',
                                    boxShadow: '0 1px 2px rgba(0,0,0,0.1)'
                                }
                            }),
                            // Informations de la formule
                            React.createElement('div', {
                                style: {
                                    flex: 1
                                }
                            },
                                React.createElement('div', {
                                    style: {
                                        fontWeight: 'bold',
                                        fontSize: '14px',
                                        marginBottom: '4px'
                                    }
                                }, data.referenceFormula.id),
                                React.createElement('div', {
                                    style: {
                                        fontSize: '13px',
                                        color: '#666'
                                    }
                                }, data.referenceFormula.name)
                            ),
                            // Bouton pour voir la formule
                            React.createElement(Button, {
                                type: 'link',
                                icon: '👁️',
                                size: 'small'
                            }, 'Voir')
                        )
                    )
                );
            };

            const tabItems = [
                {
                    key: 'color',
                    label: React.createElement('span', null, '🎨 Couleur'),
                    children: renderColorTab(briefData.color)
                },
                {
                    key: 'performance',
                    label: React.createElement('span', null, '⚡ Performance'),
                    children: renderPerformanceTab(briefData.performance)
                },
                {
                    key: 'security',
                    label: React.createElement('span', null, '🌱 Green & Sécurisation'),
                    children: renderSecurityTab(briefData.security)
                },
                {
                    key: 'cost',
                    label: React.createElement('span', null, '💰 Coût'),
                    children: renderCostTab(briefData.cost)
                },
                {
                    key: 'references',
                    label: React.createElement('span', null, '📋 Références'),
                    children: renderReferencesTab()
                }
            ];

            return React.createElement(Tabs, {
                items: tabItems,
                defaultActiveKey: 'color'
            });
        }

        // Helper pour les éléments d'information dans l'onglet Références
        const renderInfoItem = (label, value) => {
            return React.createElement('div', null,
                React.createElement('div', {
                    style: {
                        fontSize: '12px',
                        color: '#666',
                        marginBottom: '4px'
                    }
                }, label),
                React.createElement('div', {
                    style: {
                        fontSize: '14px'
                    }
                }, value)
            );
        };
        
        // Helper pour les contacts dans l'onglet Références
        const renderContactItem = (label, email) => {
            return React.createElement('div', null,
                React.createElement('div', {
                    style: {
                        fontSize: '12px',
                        color: '#666',
                        marginBottom: '4px'
                    }
                }, label),
                React.createElement('a', {
                    href: email ? `mailto:${email}` : '#',
                    style: {
                        fontSize: '14px',
                        color: email ? '#1890ff' : '#999',
                        textDecoration: email ? 'underline' : 'none',
                        cursor: email ? 'pointer' : 'default'
                    }
                }, email || 'Non assigné')
            );
        };
        
        // Fonction pour rendre l'onglet Références
        const renderReferencesTab = () => {
            // Mock des données de référence
            const referenceData = [
                {
                    "ProjectId": 206958,
                    "ProjectName": "MKAORCHESTRA23-copie-copie-copie",
                    "ProjectNatureName": "Product",
                    "ProjectPhaseName": "Definition",
                    "ProjectStatusName": "Active",
                    "ProjectTypeName": "Pilar / Launch",
                    "LaunchId": 202933,
                    "LaunchName": "TEST",
                    "LaunchNatureName": "MKT",
                    "LaunchTypeName": "New launch",
                    "DivisionCode": "ACD",
                    "DivisionName": "Active Cosmetics Division",
                    "SignatureCode": "SI0043",
                    "SignatureName": "La Roche Posay",
                    "FranchiseCode": "FR0221",
                    "FranchiseName": "La Roche Posay",
                    "BrandCode": "BR0001",
                    "BrandName": "Active C",
                    "SubBrandCode": null,
                    "SubBrandName": null,
                    "AxisCode": "AX003",
                    "AxisName": "Skin Care",
                    "SubAxisCode": "SX013",
                    "SubAxisName": "Body Care",
                    "MetierCode": "ME045",
                    "MetierName": "Body Moisturizing",
                    "MarketingZoneName": "Inter",
                    "OperationalDevelopmentZoneName": null,
                    "OpeDevProjectManagerName": "thierry.blanchard@loreal.com",
                    "MktProjectManagerName": "mansi.karode@loreal.com",
                    "ColorAndArtworkProjectManager": null,
                    "PackagingProjectManager": null,
                    "MasterProjectId": null,
                    "MasterProjectName": null,
                    "Description": null,
                    "References": [
                        {
                            "ReferenceId": 74075,
                            "ReferenceName": "MKAORCHESTRA23",
                            "ProductCategory": "Gift",
                            "PrimaryTypeOfPackaging": "Bottle",
                            "Capacity": 150.00,
                            "CapacityUnit": "ml",
                            "NbOfColorsShadesStrengths": 1,
                            "CommercialZone": "Inter",
                            "TargetPAD": "2027-10-28",
                            "Plant": "Baddi",
                            "CompassCode": null
                        }
                    ],
                    "ProjectUrl": "https://magellan-dev.loreal.net/ProductProject/ProductProject.aspx?productprojectId=206958",
                    "ProjectImage": null,
                    "ImageName": null
                }
            ];

            return React.createElement('div', { style: { padding: '16px 0' } },
                // Section projet
                React.createElement('div', {
                    style: {
                        borderRadius: '8px',
                        border: '1px solid #e8e8e8',
                        padding: '16px',
                        background: '#fafafa',
                        marginBottom: '24px'
                    }
                },
                    React.createElement('div', {
                        style: {
                            fontWeight: 'bold',
                            marginBottom: '12px',
                            fontSize: '16px',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center'
                        }
                    }, 
                        React.createElement('span', null, 'Projet'),
                        React.createElement('a', {
                            href: referenceData[0].ProjectUrl,
                            target: '_blank',
                            style: {
                                color: '#1890ff',
                                fontSize: '14px'
                            }
                        }, 'Voir dans Magellan')
                    ),
                    
                    // Détails du projet
                    React.createElement('div', {
                        style: {
                            display: 'grid',
                            gridTemplateColumns: 'repeat(2, 1fr)',
                            gap: '16px',
                            marginBottom: '16px'
                        }
                    },
                        renderInfoItem('Projet', referenceData[0].ProjectName),
                        renderInfoItem('ID', referenceData[0].ProjectId),
                        renderInfoItem('Nature', referenceData[0].ProjectNatureName),
                        renderInfoItem('Phase', referenceData[0].ProjectPhaseName),
                        renderInfoItem('Status', React.createElement(Tag, { 
                            color: referenceData[0].ProjectStatusName === 'Active' ? 'green' : 'default' 
                        }, referenceData[0].ProjectStatusName)),
                        renderInfoItem('Type', referenceData[0].ProjectTypeName)
                    ),
                    
                    // Informations sur la marque
                    React.createElement('div', {
                        style: {
                            marginTop: '24px',
                            borderTop: '1px solid #e8e8e8',
                            paddingTop: '16px'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                fontWeight: 'bold',
                                marginBottom: '12px',
                                fontSize: '14px'
                            }
                        }, 'Information marque'),
                        
                        React.createElement('div', {
                            style: {
                                display: 'grid',
                                gridTemplateColumns: 'repeat(2, 1fr)',
                                gap: '16px'
                            }
                        },
                            renderInfoItem('Division', `${referenceData[0].DivisionName} (${referenceData[0].DivisionCode})`),
                            renderInfoItem('Signature', `${referenceData[0].SignatureName} (${referenceData[0].SignatureCode})`),
                            renderInfoItem('Franchise', `${referenceData[0].FranchiseName} (${referenceData[0].FranchiseCode})`),
                            renderInfoItem('Marque', `${referenceData[0].BrandName} (${referenceData[0].BrandCode})`),
                            renderInfoItem('Axe', `${referenceData[0].AxisName} (${referenceData[0].AxisCode})`),
                            renderInfoItem('Sous-axe', `${referenceData[0].SubAxisName} (${referenceData[0].SubAxisCode})`),
                            renderInfoItem('Métier', `${referenceData[0].MetierName} (${referenceData[0].MetierCode})`),
                            renderInfoItem('Zone marketing', referenceData[0].MarketingZoneName)
                        )
                    ),
                    
                    // Section Lancement
                    React.createElement('div', {
                        style: {
                            borderRadius: '8px',
                            border: '1px solid #e8e8e8',
                            padding: '16px',
                            background: '#fafafa',
                            marginBottom: '24px'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                fontWeight: 'bold',
                                marginBottom: '12px',
                                fontSize: '16px'
                            }
                        }, 'Lancement'),
                        
                        React.createElement('div', {
                            style: {
                                display: 'grid',
                                gridTemplateColumns: 'repeat(2, 1fr)',
                                gap: '16px'
                            }
                        },
                            renderInfoItem('Nom', referenceData[0].LaunchName),
                            renderInfoItem('ID', referenceData[0].LaunchId),
                            renderInfoItem('Nature', referenceData[0].LaunchNatureName),
                            renderInfoItem('Type', referenceData[0].LaunchTypeName)
                        )
                    ),
                    
                    // Section Références
                    React.createElement('div', {
                        style: {
                            borderRadius: '8px',
                            border: '1px solid #e8e8e8',
                            padding: '16px',
                            background: '#fafafa'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                fontWeight: 'bold',
                                marginBottom: '16px',
                                fontSize: '16px',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px'
                            }
                        }, 
                        `Références (${referenceData[0].References.length + 4})`,
                        React.createElement(Tag, { color: 'warning' }, 'API MAGELLAN en cours de dev')
                        ),
                        
                        // Message informatif sur la diversification
                        React.createElement('div', {
                            style: {
                                marginBottom: '16px',
                                padding: '12px',
                                backgroundColor: '#e6f7ff',
                                borderRadius: '6px',
                                border: '1px solid #91d5ff',
                                display: 'flex',
                                alignItems: 'flex-start',
                                gap: '8px'
                            }
                        },
                            React.createElement('span', {
                                style: {
                                    fontSize: '16px',
                                    color: '#1890ff'
                                }
                            }, 'ℹ️'),
                            React.createElement('div', null, 
                                'La diversification va désormais être gérée dans le cadre de New RM codification, avec la création de formules variantes correspondant aux différentes références, automatiquement. Vous n\'aurez qu\'à vérifier grâce au nouvel assistant que les TN adaptées (tradenames) seront disponibles. Un lien vers un PowerBI du sourcing présentera les stocks disponibles pour chaque TN.'
                            )
                        ),
                        
                        // Liste des références
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '12px'
                            }
                        },
                            // Référence existante
                            referenceData[0].References.map((ref, index) => 
                                React.createElement('div', {
                                    key: index,
                                    style: {
                                        border: '1px solid #e8e8e8',
                                        borderRadius: '6px',
                                        padding: '12px',
                                        backgroundColor: 'white',
                                        transition: 'all 0.3s ease'
                                    },
                                    onMouseEnter: (e) => {
                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                                    },
                                    onMouseLeave: (e) => {
                                        e.currentTarget.style.transform = 'none';
                                        e.currentTarget.style.boxShadow = 'none';
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            marginBottom: '8px'
                                        }
                                    },
                                        React.createElement('div', {
                                            style: {
                                                fontWeight: 'bold',
                                                fontSize: '14px'
                                            }
                                        }, ref.ReferenceName),
                                        React.createElement('div', {
                                            style: {
                                                display: 'flex',
                                                gap: '8px'
                                            }
                                        },
                                            React.createElement(Tag, { color: 'processing' }, 'ID: ' + ref.ReferenceId),
                                            React.createElement(Tag, { color: 'orange' }, 'OTC')
                                        )
                                    ),
                                    
                                    React.createElement('div', {
                                        style: {
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(3, 1fr)',
                                            gap: '12px'
                                        }
                                    },
                                        renderInfoItem('Catégorie', ref.ProductCategory),
                                        renderInfoItem('Packaging', ref.PrimaryTypeOfPackaging),
                                        renderInfoItem('Capacité', `${ref.Capacity} ${ref.CapacityUnit}`),
                                        renderInfoItem('Nb de nuances', ref.NbOfColorsShadesStrengths),
                                        renderInfoItem('Zone', ref.CommercialZone),
                                        renderInfoItem('PAD cible', new Date(ref.TargetPAD).toLocaleDateString()),
                                        renderInfoItem('Usine', ref.Plant),
                                        renderInfoItem('Code Compass', ref.CompassCode || '—')
                                    ),
                                    
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            justifyContent: 'flex-end',
                                            marginTop: '12px'
                                        }
                                    },
                                        React.createElement(Button, {
                                            size: 'small',
                                            type: 'default',
                                            icon: '📄'
                                        }, 'Détails complets')
                                    )
                                )
                            ),
                            
                            // Nouvelle référence CSAR
                            React.createElement('div', {
                                key: 'csar',
                                style: {
                                    border: '1px solid #e8e8e8',
                                    borderRadius: '6px',
                                    padding: '12px',
                                    backgroundColor: 'white',
                                    transition: 'all 0.3s ease'
                                },
                                onMouseEnter: (e) => {
                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                                },
                                onMouseLeave: (e) => {
                                    e.currentTarget.style.transform = 'none';
                                    e.currentTarget.style.boxShadow = 'none';
                                }
                            },
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        marginBottom: '8px'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            fontWeight: 'bold',
                                            fontSize: '14px'
                                        }
                                    }, 'CSAR-2023'),
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            gap: '8px'
                                        }
                                    },
                                        React.createElement(Tag, { color: 'processing' }, 'ID: 74076'),
                                        React.createElement(Tag, { color: 'green' }, 'CSAR'),
                                        React.createElement(Tag, { color: 'blue' }, 'new')
                                    )
                                ),
                                
                                React.createElement('div', {
                                    style: {
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(3, 1fr)',
                                        gap: '12px'
                                    }
                                },
                                    renderInfoItem('Catégorie', 'Soins'),
                                    renderInfoItem('Packaging', 'Tube'),
                                    renderInfoItem('Capacité', '150 ml'),
                                    renderInfoItem('Nb de nuances', '1'),
                                    renderInfoItem('Zone', 'EMEA'),
                                    renderInfoItem('PAD cible', new Date('2024-06-15').toLocaleDateString()),
                                    renderInfoItem('Usine', 'Saint-Quentin'),
                                    renderInfoItem('Code Compass', 'CSAR-2023')
                                ),
                                
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'flex-end',
                                        marginTop: '12px'
                                    }
                                },
                                    React.createElement(Button, {
                                        size: 'small',
                                        type: 'default',
                                        icon: '📄'
                                    }, 'Détails complets')
                                )
                            ),
                            
                            // Nouvelle référence HALAL
                            React.createElement('div', {
                                key: 'halal',
                                style: {
                                    border: '1px solid #e8e8e8',
                                    borderRadius: '6px',
                                    padding: '12px',
                                    backgroundColor: 'white',
                                    transition: 'all 0.3s ease'
                                },
                                onMouseEnter: (e) => {
                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                                },
                                onMouseLeave: (e) => {
                                    e.currentTarget.style.transform = 'none';
                                    e.currentTarget.style.boxShadow = 'none';
                                }
                            },
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        marginBottom: '8px'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            fontWeight: 'bold',
                                            fontSize: '14px'
                                        }
                                    }, 'HALAL-2023'),
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            gap: '8px'
                                        }
                                    },
                                        React.createElement(Tag, { color: 'processing' }, 'ID: 74077'),
                                        React.createElement(Tag, { color: 'purple' }, 'HALAL'),
                                        React.createElement(Tag, { color: 'blue' }, 'new')
                                    )
                                ),
                                
                                React.createElement('div', {
                                    style: {
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(3, 1fr)',
                                        gap: '12px'
                                    }
                                },
                                    renderInfoItem('Catégorie', 'Soins'),
                                    renderInfoItem('Packaging', 'Flacon'),
                                    renderInfoItem('Capacité', '200 ml'),
                                    renderInfoItem('Nb de nuances', '1'),
                                    renderInfoItem('Zone', 'MEA'),
                                    renderInfoItem('PAD cible', new Date('2024-07-20').toLocaleDateString()),
                                    renderInfoItem('Usine', 'Cairo'),
                                    renderInfoItem('Code Compass', 'HALAL-2023')
                                ),
                                
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'flex-end',
                                        marginTop: '12px'
                                    }
                                },
                                    React.createElement(Button, {
                                        size: 'small',
                                        type: 'default',
                                        icon: '📄'
                                    }, 'Détails complets')
                                )
                            ),
                            
                            // Référence sans attribut spécifique
                            React.createElement('div', {
                                key: 'standard',
                                style: {
                                    border: '1px solid #e8e8e8',
                                    borderRadius: '6px',
                                    padding: '12px',
                                    backgroundColor: 'white',
                                    transition: 'all 0.3s ease'
                                },
                                onMouseEnter: (e) => {
                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                                },
                                onMouseLeave: (e) => {
                                    e.currentTarget.style.transform = 'none';
                                    e.currentTarget.style.boxShadow = 'none';
                                }
                            },
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        marginBottom: '8px'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            fontWeight: 'bold',
                                            fontSize: '14px'
                                        }
                                    }, 'STANDARD-2023'),
                                    React.createElement('div', null,
                                        React.createElement(Tag, { color: 'processing' }, 'ID: 74078')
                                    )
                                ),
                                
                                React.createElement('div', {
                                    style: {
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(3, 1fr)',
                                        gap: '12px'
                                    }
                                },
                                    renderInfoItem('Catégorie', 'Soins'),
                                    renderInfoItem('Packaging', 'Pot'),
                                    renderInfoItem('Capacité', '50 ml'),
                                    renderInfoItem('Nb de nuances', '1'),
                                    renderInfoItem('Zone', 'Global'),
                                    renderInfoItem('PAD cible', new Date('2024-05-10').toLocaleDateString()),
                                    renderInfoItem('Usine', 'Montreal'),
                                    renderInfoItem('Code Compass', 'STD-2023')
                                ),
                                
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'flex-end',
                                        marginTop: '12px'
                                    }
                                },
                                    React.createElement(Button, {
                                        size: 'small',
                                        type: 'default',
                                        icon: '📄'
                                    }, 'Détails complets')
                                )
                            )
                        )
                    ),
                    
                    // Section Contacts
                    React.createElement('div', {
                        style: {
                            borderRadius: '8px',
                            border: '1px solid #e8e8e8',
                            padding: '16px',
                            background: '#fafafa',
                            marginTop: '24px'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                fontWeight: 'bold',
                                marginBottom: '12px',
                                fontSize: '16px'
                            }
                        }, 'Contacts'),
                        
                        React.createElement('div', {
                            style: {
                                display: 'grid',
                                gridTemplateColumns: 'repeat(2, 1fr)',
                                gap: '16px'
                            }
                        },
                            renderContactItem('Chef de projet OpeDiv', referenceData[0].OpeDevProjectManagerName),
                            renderContactItem('Chef de projet Marketing', referenceData[0].MktProjectManagerName),
                            renderContactItem('Responsable Couleur & Artwork', referenceData[0].ColorAndArtworkProjectManager || '—'),
                            renderContactItem('Responsable Packaging', referenceData[0].PackagingProjectManager || '—')
                        )
                    )
                )
            );
        };

        function FormulaCard({ formula, onPin, onCommentClick, milestones, pinnedTo, starFormulas, onStarClick, isSelected, onSelect }) {
            const [pinMenuVisible, setPinMenuVisible] = React.useState(false);
            const [resultsExpanded, setResultsExpanded] = React.useState(true);
            const [expertisesExpanded, setExpertisesExpanded] = React.useState(false);

            const handlePinClick = (milestone) => {
                setPinMenuVisible(false);
                onPin && onPin(formula, milestone);
            };

            const typeStyles = {
                star: {
                    borderTop: '3px solid #FFD700',
                    background: 'linear-gradient(180deg, rgba(255,215,0,0.05) 0%, rgba(255,255,255,1) 100%)'
                },
                initial: {
                    borderTop: '3px solid #87CEEB',
                    background: 'linear-gradient(180deg, rgba(135,206,235,0.05) 0%, rgba(255,255,255,1) 100%)'
                },
                regular: {
                    borderTop: '1px solid var(--border-color)'
                }
            };

            const typeIcons = {
                star: '⭐',
                initial: '🏁',
                regular: ''
            };

            const typeLabels = {
                star: 'Formule star',
                initial: 'Initiale',
                regular: ''
            };

            const PinMenu = React.createElement(Menu, {
                onClick: ({ keyPath }) => {
                    if (keyPath.length === 2) {
                        const [subMilestone, milestone] = keyPath;
                        const selectedMilestone = milestones.find(m => m.title === milestone);
                        const selectedSubMilestone = selectedMilestone.subMilestones.find(sm => sm.id === subMilestone);
                        handlePinClick({
                            ...selectedMilestone,
                            subMilestone: selectedSubMilestone
                        });
                    }
                },
                items: milestones.map(milestone => ({
                    key: milestone.title,
                    label: React.createElement('div', {
                        style: { display: 'flex', alignItems: 'center', gap: '8px' }
                    },
                        React.createElement('span', null, milestone.icon),
                        React.createElement('span', null, milestone.title)
                    ),
                    children: milestone.subMilestones?.map(subMilestone => ({
                        key: subMilestone.id,
                        label: React.createElement('div', {
                            style: { 
                                display: 'flex', 
                                alignItems: 'center', 
                                justifyContent: 'space-between'
                            }
                        },
                            React.createElement('span', null, subMilestone.title),
                            pinnedTo?.some(pin => pin.milestone === milestone.title && pin.subMilestone === subMilestone.id) && 
                            React.createElement('span', { 
                                style: { color: '#52c41a' }
                            }, '📌')
                        )
                    }))
                }))
            });

            const MetricBar = ({ name, value, score, total }) => React.createElement('div', { 
                style: { marginBottom: '12px' }
            },
                React.createElement('div', { 
                    style: { 
                        display: 'flex', 
                        justifyContent: 'space-between',
                        marginBottom: '4px',
                        fontSize: '0.9em'
                    }
                },
                    React.createElement('span', null, name),
                    React.createElement('span', null, value)
                ),
                React.createElement('div', {
                    style: {
                        height: '4px',
                        background: '#f0f0f0',
                        borderRadius: '2px'
                    }
                },
                    React.createElement('div', {
                        style: {
                            width: `${(score/total) * 100}%`,
                            height: '100%',
                            background: '#1890ff',
                            borderRadius: '2px'
                        }
                    })
                ),
                React.createElement('div', { 
                    style: { 
                        textAlign: 'right',
                        fontSize: '0.8em',
                        color: '#666'
                    }
                }, `${score}/${total}`)
            );
            
            const SectionHeader = ({ title, expanded, onToggle, count }) => React.createElement('div', {
                style: {
                    display: 'flex',
                    alignItems: 'center',
                    padding: '8px 12px',
                    background: '#fafafa',
                    borderRadius: '4px 4px 0 0',
                    cursor: 'pointer',
                    userSelect: 'none'
                },
                onClick: (e) => {
                    e.stopPropagation(); // Prevent card selection when toggling sections
                    onToggle();
                }
            },
                React.createElement('span', {
                    style: {
                        transform: expanded ? 'rotate(90deg)' : 'none',
                        display: 'inline-block',
                        transition: 'transform 0.2s'
                    }
                }, '▶'),
                React.createElement('span', {
                    style: {
                        marginLeft: '8px',
                        fontWeight: 'bold',
                        flex: 1
                    }
                }, title),
                count && React.createElement(Tag, {
                    style: { marginLeft: '8px' }
                }, count)
            );

            const ExpertiseItem = ({ expertise, onPin, formula, milestones, onCommentClick }) => React.createElement('div', {
                style: {
                    padding: '12px',
                    borderBottom: '1px solid #f0f0f0',
                    fontSize: '0.9em',
                    cursor: 'pointer',
                    transition: 'all 0.3s ease',
                    borderRadius: '4px',
                    margin: '4px',
                    position: 'relative'
                },
                onMouseEnter: (e) => {
                    e.currentTarget.style.transform = 'translateY(-2px)';
                    e.currentTarget.style.backgroundColor = '#f8f8f8';
                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                    e.currentTarget.style.borderColor = '#e8e8e8';
                },
                onMouseLeave: (e) => {
                    e.currentTarget.style.transform = 'none';
                    e.currentTarget.style.backgroundColor = 'transparent';
                    e.currentTarget.style.boxShadow = 'none';
                    e.currentTarget.style.borderColor = '#f0f0f0';
                }
            },
                // Contenu de l'expertise
                React.createElement('div', {
                    style: {
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '8px'
                    }
                },
                    React.createElement('span', {
                        style: { 
                            fontWeight: 'bold',
                            color: expertise.status === 'completed' ? 'var(--success-color)' : 'var(--primary-color)'
                        }
                    }, 
                        expertise.type === 'Microbio' ? 'Microbio - Culture' :
                        expertise.type === 'Safety' ? 'Safety - AMM' :
                        expertise.type
                    ),
                    React.createElement('div', {
                        style: { display: 'flex', gap: '8px', alignItems: 'center' }
                    },
                        React.createElement(Tag, {
                            color: expertise.status === 'completed' ? 'success' : 'processing'
                        }, expertise.status === 'completed' ? 'Terminé' : 'En cours'),
                        expertise.status === 'completed' && React.createElement(Button, {
                            size: 'small',
                            icon: '📌',
                            onClick: (e) => {
                                e.stopPropagation();
                                const milestone = milestones.find(m => m.title === expertise.type);
                                if (milestone) {
                                    onPin(formula, milestone);
                                }
                            }
                        }, 'Pin')
                    )
                ),
                React.createElement('div', {
                    style: { 
                        color: '#666',
                        marginBottom: '8px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px'
                    }
                },
                    React.createElement('span', {
                        style: {
                            backgroundColor: '#f0f0f0',
                            padding: '2px 8px',
                            borderRadius: '12px',
                            fontSize: '0.9em'
                        }
                    }, `${expertise.expert}`),
                    React.createElement('span', null, expertise.date)
                ),
                expertise.comment && React.createElement('div', {
                    style: {
                        background: '#f6ffed',
                        border: '1px solid #b7eb8f',
                        borderRadius: '4px',
                        padding: '8px',
                        marginTop: '8px'
                    }
                }, expertise.comment),
                React.createElement('div', {
                    style: {
                        marginTop: '12px',
                        display: 'flex',
                        gap: '16px'
                    }
                },
                    React.createElement(Button, {
                        type: 'link',
                        size: 'small',
                        icon: '📄',
                        onClick: (e) => {
                            e.stopPropagation();
                            window.location.href = `/expertise-request/${expertise.requestId}`;
                        }
                    }, 'Voir la demande'),
                    React.createElement(Button, {
                        type: 'link',
                        size: 'small',
                        icon: '📊',
                        onClick: (e) => {
                            e.stopPropagation();
                            window.location.href = 'https://powerbi.com/expertise-results';
                        }
                    }, 'Résultats'),
                    React.createElement(Button, {
                        type: 'link',
                        size: 'small',
                        icon: '💬',
                        onClick: (e) => {
                            e.stopPropagation();
                            onCommentClick && onCommentClick({
                                ...formula,
                                title: `${formula.id} - ${expertise.type}`,
                                comment: expertise.comment
                            });
                        }
                    }, 'Commenter')
                )
            );
            
            const ResultSection = ({ title, results, type }) => {
                return React.createElement('div', {
                    className: 'result-section'
                },
                    React.createElement('div', {
                        className: 'result-section-title'
                    }, title),
                    results.map(result => {
                        const resultCard = (() => {
                            switch(type) {
                                case 'performance':
                                    return React.createElement('div', {
                                        className: 'metric-bar'
                                    },
                                        React.createElement('div', { 
                                            className: 'metric-header'
                                        },
                                            React.createElement('span', null, result.name),
                                            React.createElement('span', null, result.value)
                                        ),
                                        React.createElement('div', {
                                            className: 'metric-progress'
                                        },
                                            React.createElement('div', {
                                                className: 'metric-progress-bar',
                                                style: {
                                                    width: `${(result.score/result.total) * 100}%`
                                                }
                                            })
                                        ),
                                        React.createElement('div', { 
                                            className: 'metric-score'
                                        }, `${result.score}/${result.total}`)
                                    );
                                case 'security':
                                    return React.createElement('div', {
                                        className: 'metric-bar'
                                    },
                                        React.createElement('div', {
                                            className: 'metric-header'
                                        },
                                            React.createElement('span', null, `${result.name}:`),
                                            React.createElement(Tag, {
                                                color: result.status === 'compliant' ? 'success' : 
                                                      result.status === 'near_compliant' ? 'warning' : 'error'
                                            }, result.value.split(': ')[1] || result.value)
                                        )
                                    );
                                case 'cost':
                                    return React.createElement('div', {
                                        className: 'metric-bar'
                                    },
                                        React.createElement('div', {
                                            className: 'metric-header'
                                        },
                                            React.createElement('span', null, result.name),
                                            React.createElement(Tag, {
                                                color: result.status === 'on_target' ? 'success' :
                                                      result.status === 'near_target' ? 'warning' : 'error'
                                            }, result.value)
                                        )
                                    );
                                default:
                                    return null;
                            }
                        })();

                        return React.createElement('div', {
                            key: result.name,
                            style: {
                                padding: '10px 12px',
                                marginBottom: '8px',
                                borderRadius: '6px',
                                transition: 'all 0.3s ease',
                                position: 'relative',
                                backgroundColor: 'white',
                                border: '1px solid transparent'
                            },
                            onMouseEnter: (e) => {
                                e.currentTarget.style.transform = 'translateY(-2px)';
                                e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                                e.currentTarget.style.borderColor = '#e8e8e8';
                                e.currentTarget.style.backgroundColor = '#fafafa';
                            },
                            onMouseLeave: (e) => {
                                e.currentTarget.style.transform = 'none';
                                e.currentTarget.style.boxShadow = 'none';
                                e.currentTarget.style.borderColor = 'transparent';
                                e.currentTarget.style.backgroundColor = 'white';
                            }
                        }, resultCard);
                    })
                );
            };

            // Créer le menu d'expertise pour les actions de la formule
            const expertiseSubmenuItems = createExpertiseSubmenu(handleExpertiseRequest);
            
            // Define menu items for the actions dropdown
            const actionMenuItems = [
                {
                    key: 'comment',
                    label: 'Commenter',
                    icon: '💬',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        onCommentClick && onCommentClick(formula);
                    }
                },
                {
                    key: 'star',
                    label: starFormulas.has(formula.id) ? 'Retirer comme star' : 'Marquer comme star',
                    icon: starFormulas.has(formula.id) ? '⭐' : '☆',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        onStarClick(formula.id);
                    }
                },
                {
                    key: 'expertise',
                    label: 'Demander une expertise',
                    icon: '🔬',
                    children: expertiseSubmenuItems
                },
                {
                    key: 'duplicate',
                    label: 'Dupliquer',
                    icon: '📋',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        console.log('Duplicate clicked for formula:', formula.id);
                    }
                },
                {
                    type: 'divider'
                },
                {
                    key: 'simulate',
                    label: 'Simuler',
                    icon: '🔬',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        console.log('Simulate clicked');
                    }
                },
                {
                    key: 'manufacture',
                    label: 'Fabriquer',
                    icon: '⚗️',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        console.log('Manufacture clicked');
                    }
                },
                {
                    key: 'study',
                    label: 'Lancer étude',
                    icon: '📋',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        console.log('Launch study clicked');
                    }
                },
                {
                    key: 'compare',
                    label: 'Comparer',
                    icon: '⚖️',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        console.log('Compare clicked');
                    }
                },
                {
                    type: 'divider'
                },
                {
                    key: 'officialize',
                    label: 'Officialiser',
                    icon: '✨',
                    onClick: (e) => {
                        e.domEvent.stopPropagation();
                        console.log('Officialize clicked');
                    }
                }
            ];

            const ActionsMenu = React.createElement(Menu, { items: actionMenuItems });

            // Existing function to render performance results
            const renderPerformanceResults = (results) => {
                return React.createElement('div', {
                    style: { marginBottom: '16px' }
                },
                    React.createElement('div', {
                        style: { fontWeight: 'bold', marginBottom: '8px' }
                    }, '⚡ Performance'),
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '6px'
                            }
                        },
                            React.createElement('div', {
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    backgroundColor: '#363636',  // Hardcoded from briefData.color.targetShade.hex
                                    borderRadius: '4px',
                                    border: '1px solid #e8e8e8'
                                }
                            }),
                            React.createElement('span', {
                                style: { fontSize: '12px', color: '#666' }
                            }, 'Cible'),
                            React.createElement('div', {
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    // Simple approximation of LAB color to RGB for display
                                    backgroundColor: 
                                        results.status === 'on_target' ? '#363636' :  // Similar to target
                                        results.status === 'close' ? '#404040' :  // Slightly different
                                        '#555555',  // Quite different
                                    borderRadius: '4px',
                                    border: '1px solid #e8e8e8'
                                }
                            }),
                            React.createElement('span', {
                                style: { fontSize: '12px', color: '#666' }
                            }, 'Résultat')
                        ),
                        React.createElement('div', { style: { width: '12px' } }),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '2px'
                            }
                        },
                            React.createElement('div', {
                                style: { fontSize: '12px', color: '#666' }
                            }, `Cible: ${results.target}`),
                            React.createElement('div', {
                                style: { fontSize: '12px', color: '#666' }
                            }, `Actuel: ${results.actual}`)
                        ),
                        React.createElement('div', { style: { width: '12px' } }),
                        React.createElement(Tag, {
                            color: results.status === 'on_target' ? 'success' :
                                   results.status === 'close' ? 'warning' : 'error'
                        }, results.status === 'on_target' ? 'Conforme' : results.status === 'close' ? 'Proche' : 'Hors cible')
                    )
                );
            };

            // Existing function to render security results
            const renderSecurityResults = (results) => {
                return React.createElement('div', {
                    style: { marginBottom: '16px' }
                },
                    React.createElement('div', {
                        style: { fontWeight: 'bold', marginBottom: '8px' }
                    }, '🌱 Green & Sécurisation'),
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '6px'
                            }
                        },
                            React.createElement('div', {
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    backgroundColor: '#363636',  // Hardcoded from briefData.color.targetShade.hex
                                    borderRadius: '4px',
                                    border: '1px solid #e8e8e8'
                                }
                            }),
                            React.createElement('span', {
                                style: { fontSize: '12px', color: '#666' }
                            }, 'Cible'),
                            React.createElement('div', {
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    // Simple approximation of LAB color to RGB for display
                                    backgroundColor: 
                                        results.status === 'compliant' ? '#363636' :  // Similar to target
                                        results.status === 'near_compliant' ? '#404040' :  // Slightly different
                                        '#555555',  // Quite different
                                    borderRadius: '4px',
                                    border: '1px solid #e8e8e8'
                                }
                            }),
                            React.createElement('span', {
                                style: { fontSize: '12px', color: '#666' }
                            }, 'Résultat')
                        ),
                        React.createElement('div', { style: { width: '12px' } }),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '2px'
                            }
                        },
                            React.createElement('div', {
                                style: { fontSize: '12px', color: '#666' }
                            }, `Cible: ${results.target}`),
                            React.createElement('div', {
                                style: { fontSize: '12px', color: '#666' }
                            }, `Actuel: ${results.actual}`)
                        ),
                        React.createElement('div', { style: { width: '12px' } }),
                        React.createElement(Tag, {
                            color: results.status === 'compliant' ? 'success' :
                                   results.status === 'near_compliant' ? 'warning' : 'error'
                        }, results.status === 'compliant' ? 'Conforme' : results.status === 'near_compliant' ? 'Proche' : 'Hors cible')
                    )
                );
            };

            // Existing function to render cost results
            const renderCostResults = (results) => {
                return React.createElement('div', {
                    style: { marginBottom: '16px' }
                },
                    React.createElement('div', {
                        style: { fontWeight: 'bold', marginBottom: '8px' }
                    }, '💰 Coût'),
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '6px'
                            }
                        },
                            React.createElement('div', {
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    backgroundColor: '#363636',  // Hardcoded from briefData.color.targetShade.hex
                                    borderRadius: '4px',
                                    border: '1px solid #e8e8e8'
                                }
                            }),
                            React.createElement('span', {
                                style: { fontSize: '12px', color: '#666' }
                            }, 'Cible'),
                            React.createElement('div', {
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    // Simple approximation of LAB color to RGB for display
                                    backgroundColor: 
                                        results.status === 'on_target' ? '#363636' :  // Similar to target
                                        results.status === 'near_target' ? '#404040' :  // Slightly different
                                        '#555555',  // Quite different
                                    borderRadius: '4px',
                                    border: '1px solid #e8e8e8'
                                }
                            }),
                            React.createElement('span', {
                                style: { fontSize: '12px', color: '#666' }
                            }, 'Résultat')
                        ),
                        React.createElement('div', { style: { width: '12px' } }),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '2px'
                            }
                        },
                            React.createElement('div', {
                                style: { fontSize: '12px', color: '#666' }
                            }, `Cible: ${results.target}`),
                            React.createElement('div', {
                                style: { fontSize: '12px', color: '#666' }
                            }, `Actuel: ${results.actual}`)
                        ),
                        React.createElement('div', { style: { width: '12px' } }),
                        React.createElement(Tag, {
                            color: results.status === 'on_target' ? 'success' :
                                   results.status === 'near_target' ? 'warning' : 'error'
                        }, results.status === 'on_target' ? 'Conforme' : results.status === 'near_target' ? 'Proche' : 'Hors cible')
                    )
                );
            };

            // New function to render color results
            const renderColorResults = (results) => {
                if (!results || !results.color) return null;

                const colorResult = results.color;
                const statusColors = {
                    on_target: 'success',
                    close: 'warning',
                    off_target: 'error'
                };

                const statusLabel = {
                    on_target: 'Conforme',
                    close: 'Proche',
                    off_target: 'Hors cible'
                };

                // Création du contenu de la carte
                const colorContent = (
                    React.createElement(React.Fragment, null,
                        React.createElement('div', {
                            style: { fontWeight: 'bold', marginBottom: '8px' }
                        }, '🎨 Couleur'),
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '12px'
                            }
                        },
                            // Color swatch comparison
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px'
                                }
                            },
                                // Target color - using the color from briefData
                                React.createElement('div', {
                                    style: {
                                        width: '24px',
                                        height: '24px',
                                        backgroundColor: '#363636',  // Hardcoded from briefData.color.targetShade.hex
                                        borderRadius: '4px',
                                        border: '1px solid #e8e8e8'
                                    }
                                }),
                                React.createElement('span', {
                                    style: { fontSize: '12px', color: '#666' }
                                }, 'Cible'),
                                // Actual color - using a calculated color based on colorimetry
                                React.createElement('div', {
                                    style: {
                                        width: '24px',
                                        height: '24px',
                                        // Simple approximation of LAB color to RGB for display
                                        backgroundColor: 
                                            colorResult.status === 'on_target' ? '#363636' :  // Similar to target
                                            colorResult.status === 'close' ? '#404040' :  // Slightly different
                                            '#555555',  // Quite different
                                        borderRadius: '4px',
                                        border: '1px solid #e8e8e8'
                                    }
                                }),
                                React.createElement('span', {
                                    style: { fontSize: '12px', color: '#666' }
                                }, 'Résultat')
                            ),
                            // Gap
                            React.createElement('div', { style: { width: '12px' } }),
                            // Shade values
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexDirection: 'column',
                                    gap: '2px'
                                }
                            },
                                React.createElement('div', {
                                    style: { fontSize: '12px', color: '#666' }
                                }, `Cible: ${colorResult.targetShade}`),
                                React.createElement('div', {
                                    style: { fontSize: '12px', color: '#666' }
                                }, `Actuel: ${colorResult.actualShade}`)
                            ),
                            // Gap
                            React.createElement('div', { style: { width: '12px' } }),
                            // Status tag
                            React.createElement(Tag, {
                                color: statusColors[colorResult.status]
                            }, statusLabel[colorResult.status])
                        ),
                        // Compare button
                        React.createElement('div', {
                            style: {
                                marginTop: '8px',
                                display: 'flex',
                                justifyContent: 'flex-end'
                            }
                        },
                            React.createElement(Button, {
                                type: 'link',
                                size: 'small',
                                icon: '🔄',
                                onClick: () => {
                                    // Ouvrir le comparateur
                                    Modal.info({
                                        title: 'Comparateur de nuances',
                                        width: 900,
                                        content: React.createElement(ColorComparator, {
                                            currentColor: colorResult,
                                            targetColor: briefData.color.targetShade,
                                            formulas
                                        }),
                                        footer: null
                                    });
                                }
                            }, 'Comparer')
                        )
                    )
                );

                // Carte avec effet de survol
                return React.createElement('div', { 
                    style: { marginBottom: '16px' }
                },
                    React.createElement('div', {
                        style: {
                            padding: '10px 12px',
                            borderRadius: '6px',
                            backgroundColor: 'white',
                            border: '1px solid transparent',
                            transition: 'all 0.3s ease'
                        },
                        onMouseEnter: (e) => {
                            e.currentTarget.style.transform = 'translateY(-2px)';
                            e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                            e.currentTarget.style.borderColor = '#e8e8e8';
                            e.currentTarget.style.backgroundColor = '#fafafa';
                        },
                        onMouseLeave: (e) => {
                            e.currentTarget.style.transform = 'none';
                            e.currentTarget.style.boxShadow = 'none';
                            e.currentTarget.style.borderColor = 'transparent';
                            e.currentTarget.style.backgroundColor = 'white';
                        }
                    }, colorContent)
                );
            };

            // Nouveau composant pour comparer les couleurs
            const ColorComparator = ({ currentColor, targetColor, formulas }) => {
                const [activeIndex, setActiveIndex] = React.useState(0);
                const formulasWithColor = formulas.filter(f => f.results && f.results.color);
                const [isSlideshow, setIsSlideshow] = React.useState(false);
                const [slideshowInterval, setSlideshowInterval] = React.useState(null);
                const containerRef = React.useRef(null);
                
                // Ajouter la référence à la cible
                const allShades = [
                    {
                        id: 'target',
                        name: 'Nuance cible (brief)',
                        shade: targetColor.label,
                        hex: targetColor.hex,
                        colorimetry: targetColor.colorimetry,
                        type: 'target'
                    },
                    ...formulasWithColor.map(f => ({
                        id: f.id,
                        name: f.name,
                        shade: f.results.color.actualShade,
                        status: f.results.color.status,
                        colorimetry: f.results.color.colorimetry,
                        hex: f.type === 'star' ? '#363636' : 
                             f.results.color.status === 'on_target' ? '#363636' :
                             f.results.color.status === 'close' ? '#404040' :
                             '#555555',
                        type: f.type
                    }))
                ];
                
                // Navigation au clavier
                React.useEffect(() => {
                    const handleKeyDown = (e) => {
                        if (e.key === 'ArrowRight') {
                            setActiveIndex((prevIndex) => (prevIndex + 1) % allShades.length);
                        } else if (e.key === 'ArrowLeft') {
                            setActiveIndex((prevIndex) => (prevIndex - 1 + allShades.length) % allShades.length);
                        } else if (e.key === 'Space') {
                            toggleSlideshow();
                        } else if (e.key === 'Escape') {
                            Modal.destroyAll();
                        }
                    };
                    
                    if (containerRef.current) {
                        containerRef.current.focus();
                    }
                    
                    window.addEventListener('keydown', handleKeyDown);
                    return () => {
                        window.removeEventListener('keydown', handleKeyDown);
                        if (slideshowInterval) {
                            clearInterval(slideshowInterval);
                        }
                    };
                }, [slideshowInterval, allShades.length]);
                
                // Démarrer/arrêter le diaporama
                const toggleSlideshow = () => {
                    if (isSlideshow) {
                        clearInterval(slideshowInterval);
                        setSlideshowInterval(null);
                        setIsSlideshow(false);
                    } else {
                        const interval = setInterval(() => {
                            setActiveIndex((prevIndex) => (prevIndex + 1) % allShades.length);
                        }, 2000);
                        setSlideshowInterval(interval);
                        setIsSlideshow(true);
                    }
                };
                
                const activeShade = allShades[activeIndex];
                
                return React.createElement('div', {
                    ref: containerRef,
                    tabIndex: 0,
                    style: {
                        outline: 'none',
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '20px',
                        position: 'relative'
                    }
                },
                    // Bouton de fermeture
                    React.createElement('button', {
                        onClick: () => Modal.destroyAll(),
                        style: {
                            position: 'absolute',
                            top: '-12px',
                            right: '-12px',
                            background: '#fff',
                            border: '1px solid #ddd',
                            borderRadius: '50%',
                            width: '32px',
                            height: '32px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            cursor: 'pointer',
                            fontSize: '18px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            zIndex: 10
                        }
                    }, '✕'),
                    
                    // Instructions de navigation
                    React.createElement('div', {
                        style: {
                            backgroundColor: '#f0f7ff',
                            padding: '8px 12px',
                            borderRadius: '4px',
                            marginBottom: '8px',
                            fontSize: '13px',
                            color: '#1890ff'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between'
                            }
                        },
                            React.createElement('span', null, 
                                '⌨️ Navigation: flèches gauche/droite, barre espace pour le diaporama'),
                            React.createElement('div', null,
                                React.createElement(Button, {
                                    size: 'small',
                                    type: isSlideshow ? 'primary' : 'default',
                                    icon: isSlideshow ? '⏸️' : '▶️',
                                    onClick: toggleSlideshow
                                }, isSlideshow ? 'Pause' : 'Diaporama')
                            )
                        )
                    ),
                    
                    // Affichage principal
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            gap: '24px',
                            alignItems: 'flex-start'
                        }
                    },
                        // Panneau de navigation des nuances
                        React.createElement('div', {
                            style: {
                                width: '240px',
                                border: '1px solid #f0f0f0',
                                borderRadius: '8px',
                                overflow: 'hidden'
                            }
                        },
                            React.createElement('div', {
                                style: {
                                    padding: '12px',
                                    background: '#fafafa',
                                    borderBottom: '1px solid #f0f0f0',
                                    fontWeight: 'bold'
                                }
                            }, `Nuances (${allShades.length})`),
                            React.createElement('div', {
                                style: {
                                    maxHeight: '400px',
                                    overflowY: 'auto'
                                }
                            },
                                allShades.map((shade, idx) => 
                                    React.createElement('div', {
                                        key: shade.id,
                                        style: {
                                            padding: '12px',
                                            borderBottom: idx < allShades.length - 1 ? '1px solid #f0f0f0' : 'none',
                                            backgroundColor: activeIndex === idx ? '#e6f7ff' : 'white',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px'
                                        },
                                        onClick: () => setActiveIndex(idx)
                                    },
                                        React.createElement('div', {
                                            style: {
                                                width: '16px',
                                                height: '16px',
                                                backgroundColor: shade.hex,
                                                borderRadius: '2px',
                                                border: '1px solid #d9d9d9'
                                            }
                                        }),
                                        React.createElement('div', {
                                            style: {
                                                display: 'flex',
                                                flexDirection: 'column'
                                            }
                                        },
                                            React.createElement('div', {
                                                style: {
                                                    fontSize: '13px',
                                                    fontWeight: activeIndex === idx ? 'bold' : 'normal'
                                                }
                                            },
                                                `${shade.shade}`,
                                                shade.type === 'target' && React.createElement('span', {
                                                    style: {
                                                        marginLeft: '4px',
                                                        color: '#1890ff',
                                                        fontSize: '11px'
                                                    }
                                                }, '(cible)'),
                                                shade.type === 'star' && React.createElement('span', {
                                                    style: {
                                                        marginLeft: '4px', 
                                                        color: '#faad14',
                                                        fontSize: '11px'
                                                    }
                                                }, '⭐'),
                                                shade.type === 'initial' && React.createElement('span', {
                                                    style: {
                                                        marginLeft: '4px',
                                                        color: '#13c2c2',
                                                        fontSize: '11px'
                                                    }
                                                }, '🏁')
                                            ),
                                            React.createElement('div', {
                                                style: {
                                                    fontSize: '11px',
                                                    color: '#666',
                                                    whiteSpace: 'nowrap',
                                                    overflow: 'hidden',
                                                    textOverflow: 'ellipsis',
                                                    maxWidth: '180px'
                                                }
                                            }, shade.id !== 'target' ? shade.id : '')
                                        )
                                    )
                                )
                            )
                        ),
                        
                        // Affichage détaillé de la nuance active
                        React.createElement('div', {
                            style: {
                                flex: 1,
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '16px'
                            }
                        },
                            // Titre et description
                            React.createElement('div', null,
                                React.createElement('h3', {
                                    style: {
                                        margin: 0,
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }
                                },
                                    `Nuance ${activeShade.shade}`,
                                    activeShade.type === 'target' ? React.createElement(Tag, { color: 'blue' }, 'Cible') :
                                    activeShade.status === 'on_target' ? React.createElement(Tag, { color: 'success' }, 'Conforme') :
                                    activeShade.status === 'close' ? React.createElement(Tag, { color: 'warning' }, 'Proche') :
                                    React.createElement(Tag, { color: 'error' }, 'Hors cible')
                                ),
                                React.createElement('div', {
                                    style: {
                                        fontSize: '14px',
                                        color: '#666',
                                        marginTop: '4px'
                                    }
                                }, activeShade.name)
                            ),
                            
                            // Visualisation 
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '24px'
                                }
                            },
                                // Visualisation couleur
                                React.createElement('div', {
                                    style: {
                                        minWidth: '120px'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            width: '120px',
                                            height: '120px',
                                            backgroundColor: activeShade.hex,
                                            borderRadius: '8px',
                                            marginBottom: '12px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
                                        }
                                    }),
                                    // Simulation mèche
                                    React.createElement('div', {
                                        style: {
                                            width: '120px',
                                            height: '180px',
                                            borderRadius: '8px',
                                            overflow: 'hidden',
                                            position: 'relative',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
                                        }
                                    },
                                        Array.from({ length: 20 }, (_, i) => {
                                            const baseColor = activeShade.hex;
                                            // Générer gradient à partir de la couleur de base
                                            const gradient = `linear-gradient(180deg, ${baseColor} 0%, ${baseColor}CC 40%, ${baseColor}99 70%, ${baseColor}66 100%)`;
                                            
                                            return React.createElement('div', {
                                                key: i,
                                                style: {
                                                    position: 'absolute',
                                                    width: `${2 + Math.random() * 3}px`,
                                                    height: `${150 + Math.random() * 30}px`,
                                                    left: `${i * 5 + Math.random() * 3}%`,
                                                    top: 0,
                                                    backgroundImage: gradient,
                                                    transform: `rotate(${Math.random() * 6 - 3}deg)`,
                                                    boxShadow: '0 0 2px rgba(0,0,0,0.3)',
                                                    borderRadius: '50%/10%'
                                                }
                                            });
                                        })
                                    )
                                ),
                                
                                // Infos colorimétriques
                                React.createElement('div', {
                                    style: {
                                        flex: 1
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            marginBottom: '16px',
                                            padding: '12px',
                                            background: '#fafafa',
                                            borderRadius: '8px'
                                        }
                                    },
                                        React.createElement('div', {
                                            style: { 
                                                fontWeight: 'bold',
                                                marginBottom: '8px'
                                            }
                                        }, 'Informations colorimétriques'),
                                        
                                        // Affichage des valeurs colorimétriques
                                        React.createElement('div', {
                                            style: {
                                                display: 'grid',
                                                gridTemplateColumns: 'repeat(2, 1fr)',
                                                gap: '12px'
                                            }
                                        },
                                            React.createElement('div', null,
                                                React.createElement('span', {
                                                    style: { fontWeight: 'bold', marginRight: '4px' }
                                                }, 'L:'),
                                                activeShade.colorimetry ? activeShade.colorimetry.L : '—'
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('span', {
                                                    style: { fontWeight: 'bold', marginRight: '4px' }
                                                }, 'HEX:'),
                                                activeShade.hex || '—'
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('span', {
                                                    style: { fontWeight: 'bold', marginRight: '4px' }
                                                }, 'a:'),
                                                activeShade.colorimetry ? activeShade.colorimetry.a : '—'
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('span', {
                                                    style: { fontWeight: 'bold', marginRight: '4px' }
                                                }, 'b:'),
                                                activeShade.colorimetry ? activeShade.colorimetry.b : '—'
                                            )
                                        )
                                    ),
                                    
                                    // Comparaison avec la cible
                                    activeShade.id !== 'target' && React.createElement('div', {
                                        style: {
                                            marginBottom: '16px',
                                            padding: '12px',
                                            background: '#fafafa',
                                            borderRadius: '8px'
                                        }
                                    },
                                        React.createElement('div', {
                                            style: { 
                                                fontWeight: 'bold',
                                                marginBottom: '8px'
                                            }
                                        }, 'Comparaison avec la cible'),
                                        
                                        React.createElement('div', {
                                            style: {
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '16px'
                                            }
                                        },
                                            // Écart numérique
                                            React.createElement('div', null,
                                                React.createElement('span', {
                                                    style: { fontWeight: 'bold', marginRight: '4px' }
                                                }, 'Écart:'),
                                                isNaN(Number(activeShade.shade) - Number(targetColor.label)) ? '—' :
                                                    (Number(activeShade.shade) - Number(targetColor.label)).toFixed(1)
                                            ),
                                            
                                            // Visualisation de l'écart
                                            React.createElement('div', {
                                                style: {
                                                    flex: 1,
                                                    height: '8px',
                                                    background: '#f0f0f0',
                                                    borderRadius: '4px',
                                                    position: 'relative'
                                                }
                                            },
                                                React.createElement('div', {
                                                    style: {
                                                        position: 'absolute',
                                                        left: '50%',
                                                        height: '100%',
                                                        width: '2px',
                                                        backgroundColor: '#1890ff',
                                                        transform: 'translateX(-50%)'
                                                    }
                                                }),
                                                React.createElement('div', {
                                                    style: {
                                                        position: 'absolute',
                                                        left: '50%',
                                                        top: '-4px',
                                                        width: '12px',
                                                        height: '16px',
                                                        borderRadius: '2px',
                                                        backgroundColor: targetColor.hex,
                                                        transform: 'translateX(-50%)',
                                                        border: '1px solid white'
                                                    }
                                                }),
                                                isNaN(Number(activeShade.shade) - Number(targetColor.label)) ? null :
                                                    React.createElement('div', {
                                                        style: {
                                                            position: 'absolute',
                                                            left: `${50 + Math.min(Math.max((Number(activeShade.shade) - Number(targetColor.label)) * 25, -45), 45)}%`,
                                                            top: '-4px',
                                                            width: '12px',
                                                            height: '16px',
                                                            borderRadius: '2px',
                                                            backgroundColor: activeShade.hex,
                                                            transform: 'translateX(-50%)',
                                                            border: '1px solid white'
                                                        }
                                                    })
                                            )
                                        )
                                    ),
                                    
                                    // Boutons d'action
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            justifyContent: 'flex-end',
                                            gap: '8px',
                                            marginTop: '12px'
                                        }
                                    },
                                        activeShade.id !== 'target' && React.createElement(Button, {
                                            type: 'default',
                                            size: 'small',
                                            icon: '👁️'
                                        }, 'Voir formule'),
                                        
                                        React.createElement(Button, {
                                            type: 'primary',
                                            size: 'small',
                                            icon: '💇'
                                        }, 'Ouvrir dans SCC')
                                    )
                                )
                            )
                        )
                    )
                );
            };

            return React.createElement('div', {
                className: 'formula-card',
                style: {
                    border: '1px solid #e8e8e8',
                    borderRadius: '8px',
                    padding: '16px',
                    marginBottom: '16px',
                    cursor: 'pointer',
                    backgroundColor: isSelected ? '#f0f7ff' : 'white',
                    transition: 'all 0.2s',
                    minWidth: '320px', // Ensure a minimum width
                    marginRight: '16px' // Add spacing between cards
                },
                onClick: () => onSelect(formula.id, !isSelected)
            },
                React.createElement('div', null,
                    // Header with type indicator and checkbox
                    React.createElement('div', { 
                        style: { 
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '8px',
                            marginBottom: '12px'
                        }
                    },
                        // Top row with actions, new dropdown, and checkbox
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                justifyContent: 'space-between',
                                gap: '8px'
                            }
                        },
                            React.createElement(Dropdown, {
                                overlay: ActionsMenu,
                                trigger: ['click']
                            },
                                React.createElement(Button, {
                                    size: 'small',
                                    icon: '⚡',
                                    style: {
                                        backgroundColor: '#6B4EFF', // Couleur mauve utilisée dans le reste de l'application
                                        color: 'white',
                                        border: 'none',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '4px'
                                    },
                                    onClick: (e) => e.stopPropagation() // Prevent card selection when clicking dropdown button
                                }, 'Actions')
                            ),
                            React.createElement(Checkbox, {
                                checked: isSelected,
                                onChange: (e) => {
                                    e.stopPropagation(); // Prevent double triggering
                                    onSelect(formula.id, e.target.checked);
                                }
                            })
                        ),
                        // Middle row with iteration and ID
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px'
                            }
                        },
                            typeIcons[formula.type || 'regular'] && React.createElement('span', null, typeIcons[formula.type]),
                            React.createElement('span', {
                                style: {
                                    fontSize: '0.9em',
                                    color: '#666'
                                }
                            }, `Iteration ${formula.iteration} | `),
                            React.createElement(Button, {
                                type: 'link',
                                style: {
                                    padding: 0,
                                    fontSize: '0.9em',
                                    fontWeight: 500,
                                    height: 'auto'
                                },
                                href: `https://formulationcenter-ri.loreal.wans/formula/${formula.id}`,
                                target: '_blank',
                                onClick: (e) => e.stopPropagation() // Prevent card selection
                            }, formula.id),
                            typeLabels[formula.type] && React.createElement(Tag, {
                                color: formula.type === 'star' ? 'gold' : formula.type === 'initial' ? 'blue' : null
                            }, typeLabels[formula.type])
                        ),
                        // Bottom row with name and version
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '4px'
                            }
                        },
                            React.createElement('div', {
                                style: {
                                    fontSize: '0.9em',
                                    fontWeight: '500'
                                }
                            }, formula.name),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    fontSize: '0.9em',
                                    color: '#666'
                                }
                            },
                                React.createElement('span', null, formula.version),
                                pinnedTo && pinnedTo.length > 0 && React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '4px'
                                    }
                                },
                                    React.createElement('span', {
                                        style: { color: '#52c41a' }
                                    }, '📌'),
                                    pinnedTo.map(milestone => React.createElement(Tag, {
                                        key: milestone,
                                        color: milestones.find(m => m.title === milestone)?.color
                                    }, milestone))
                                )
                            )
                        )
                    ),
                    // Results section with subsections
                    React.createElement('div', { 
                        style: { marginBottom: '16px' }
                    },
                        React.createElement(SectionHeader, {
                            title: 'Résultats vs Brief',
                            expanded: resultsExpanded,
                            onToggle: () => setResultsExpanded(!resultsExpanded)
                        }),
                        resultsExpanded && React.createElement('div', {
                            className: 'formula-results',
                            onClick: (e) => e.stopPropagation() // Prevent card selection when clicking in results area
                        },
                            React.createElement(ResultSection, {
                                title: 'Performance',
                                results: formula.results.performance,
                                type: 'performance'
                            }),
                            React.createElement(ResultSection, {
                                title: 'Green & Sécurisation',
                                results: formula.results.security,
                                type: 'security'
                            }),
                            React.createElement(ResultSection, {
                                title: 'Coût',
                                results: formula.results.cost,
                                type: 'cost'
                            }),
                            renderColorResults(formula.results)  // Add color results
                        )
                    ),

                    // Expertises section
                    React.createElement('div', { 
                        style: { marginBottom: '16px' }
                    },
                        React.createElement(SectionHeader, {
                            title: 'Expertises',
                            expanded: expertisesExpanded,
                            onToggle: () => setExpertisesExpanded(!expertisesExpanded),
                            count: formula.expertises.length
                        }),
                        expertisesExpanded && React.createElement('div', {
                            style: {
                                background: '#fafafa',
                                borderRadius: '0 0 4px 4px'
                            },
                            onClick: (e) => e.stopPropagation() // Prevent card selection when clicking in expertises area
                        },
                            formula.expertises.length > 0 ?
                                formula.expertises.map((expertise, index) =>
                                    React.createElement(ExpertiseItem, {
                                        key: index,
                                        expertise: expertise,
                                        onPin: onPin,
                                        formula: formula,
                                        milestones: milestones,
                                        onCommentClick: onCommentClick
                                    })
                                ) :
                                React.createElement('div', {
                                    style: {
                                        padding: '12px',
                                        textAlign: 'center',
                                        color: '#666'
                                    }
                                }, "Aucune expertise en cours")
                        )
                    )
                )
            );
        }

        function Footer() {
            return React.createElement('div', { className: 'page-footer' },
                React.createElement(Button, {
                    disabled: true,
                    size: 'middle'
                }, 'Officialiser'),
                React.createElement(Button, {
                    type: 'primary',
                    size: 'middle'
                }, 'Fabriquer'),
                React.createElement(Button, {
                    size: 'middle'
                }, 'Lancer une étude'),
                React.createElement(Button, {
                    size: 'middle'
                }, 'Lancer un DOE'),
                React.createElement(Button, {
                    size: 'middle'
                }, 'Assistant de simulation'),
                React.createElement(Button, {
                    size: 'middle'
                }, 'Comparer')
            );
        }

        function TemplateDrawer({ visible, onClose, data, onSave }) {
            const [selectedMilestones, setSelectedMilestones] = React.useState(
                data.reduce((acc, milestone) => ({
                    ...acc,
                    [milestone.title]: {
                        selected: true,
                        subMilestones: milestone.subMilestones.reduce((subAcc, subMilestone) => ({
                            ...subAcc,
                            [subMilestone.id]: true
                        }), {})
                    }
                }), {})
            );
            const [templateName, setTemplateName] = React.useState('');
            const [saveMode, setSaveMode] = React.useState(false);

            const handleMilestoneChange = (milestone, checked) => {
                setSelectedMilestones(prev => ({
                    ...prev,
                    [milestone.title]: {
                        ...prev[milestone.title],
                        selected: checked,
                        subMilestones: Object.keys(prev[milestone.title].subMilestones).reduce((acc, key) => ({
                            ...acc,
                            [key]: checked
                        }), {})
                    }
                }));
            };

            const handleSubMilestoneChange = (milestone, subMilestone, checked) => {
                setSelectedMilestones(prev => ({
                    ...prev,
                    [milestone.title]: {
                        ...prev[milestone.title],
                        subMilestones: {
                            ...prev[milestone.title].subMilestones,
                            [subMilestone.id]: checked
                        }
                    }
                }));
            };

            return React.createElement(Drawer, {
                title: 'Gérer les jalons',
                placement: 'right',
                onClose: onClose,
                open: visible,
                width: 520,
                extra: React.createElement(Space, null,
                    React.createElement(Button, {
                        onClick: () => setSaveMode(true)
                    }, 'Enregistrer comme template')
                )
            },
                saveMode ? 
                    React.createElement('div', null,
                        React.createElement(Form, { layout: 'vertical' },
                            React.createElement(Form.Item, {
                                label: 'Nom du template',
                                required: true
                            },
                                React.createElement(Input, {
                                    value: templateName,
                                    onChange: e => setTemplateName(e.target.value),
                                    placeholder: 'Ex: Template Safety & Performance'
                                })
                            ),
                            React.createElement('div', {
                                style: {
                                    marginTop: '24px',
                                    textAlign: 'right'
                                }
                            },
                                React.createElement(Button, {
                                    onClick: () => setSaveMode(false),
                                    style: { marginRight: 8 }
                                }, 'Retour'),
                                React.createElement(Button, {
                                    type: 'primary',
                                    disabled: !templateName,
                                    onClick: () => {
                                        onSave({
                                            name: templateName,
                                            milestones: selectedMilestones
                                        });
                                        onClose();
                                    }
                                }, 'Enregistrer')
                            )
                        )
                    ) :
                    React.createElement('div', null,
                        data.map(milestone => 
                            React.createElement('div', {
                                key: milestone.title,
                                style: { marginBottom: '24px' }
                            },
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        alignItems: 'center',
                                        marginBottom: '8px'
                                    }
                                },
                                    React.createElement(Checkbox, {
                                        checked: selectedMilestones[milestone.title].selected,
                                        onChange: (e) => handleMilestoneChange(milestone, e.target.checked)
                                    }),
                                    React.createElement('span', {
                                        style: {
                                            marginLeft: '8px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px',
                                            fontSize: '1.1em'
                                        }
                                    },
                                        milestone.icon,
                                        React.createElement('strong', null, milestone.title)
                                    )
                                ),
                                React.createElement('div', {
                                    style: {
                                        marginLeft: '32px'
                                    }
                                },
                                    milestone.subMilestones.map(subMilestone =>
                                        React.createElement('div', {
                                            key: subMilestone.id,
                                            style: {
                                                marginBottom: '8px',
                                                display: 'flex',
                                                alignItems: 'center'
                                            }
                                        },
                                            React.createElement(Checkbox, {
                                                checked: selectedMilestones[milestone.title].subMilestones[subMilestone.id],
                                                onChange: (e) => handleSubMilestoneChange(milestone, subMilestone, e.target.checked),
                                                disabled: !selectedMilestones[milestone.title].selected
                                            }),
                                            React.createElement('span', {
                                                style: {
                                                    marginLeft: '8px',
                                                    color: selectedMilestones[milestone.title].selected ? 'inherit' : '#999'
                                                }
                                            }, subMilestone.title)
                                        )
                                    )
                                )
                            )
                        )
                    )
            );
        }

        function SubMilestoneDrawer({ visible, onClose, milestone }) {
            const [selectedExpertise, setSelectedExpertise] = React.useState('Safety');
            const [templateName, setTemplateName] = React.useState('');
            const [showSaveTemplate, setShowSaveTemplate] = React.useState(false);
            const [selections, setSelections] = React.useState({
                Safety: data.filter(m => m.title === 'Safety').reduce((acc, m) => ({
                    ...acc,
                    [m.title]: {
                        selected: true,
                        subMilestones: m.subMilestones.reduce((subAcc, sm) => ({
                            ...subAcc,
                            [sm.id]: true
                        }), {})
                    }
                }), {}),
                Microbio: data.filter(m => m.title === 'Microbio').reduce((acc, m) => ({
                    ...acc,
                    [m.title]: {
                        selected: true,
                        subMilestones: m.subMilestones.reduce((subAcc, sm) => ({
                            ...subAcc,
                            [sm.id]: true
                        }), {})
                    }
                }), {}),
                Performance: data.filter(m => m.title === 'Performance').reduce((acc, m) => ({
                    ...acc,
                    [m.title]: {
                        selected: true,
                        subMilestones: m.subMilestones.reduce((subAcc, sm) => ({
                            ...subAcc,
                            [sm.id]: true
                        }), {})
                    }
                }), {})
            });

            const handleMilestoneChange = (expertise, milestone, checked) => {
                setSelections(prev => ({
                    ...prev,
                    [expertise]: {
                        ...prev[expertise],
                        [milestone.title]: {
                            ...prev[expertise][milestone.title],
                            selected: checked,
                            subMilestones: Object.keys(prev[expertise][milestone.title].subMilestones).reduce((acc, key) => ({
                                ...acc,
                                [key]: checked
                            }), {})
                        }
                    }
                }));
            };

            const handleSubMilestoneChange = (expertise, milestone, subMilestone, checked) => {
                setSelections(prev => ({
                    ...prev,
                    [expertise]: {
                        ...prev[expertise],
                        [milestone.title]: {
                            ...prev[expertise][milestone.title],
                            subMilestones: {
                                ...prev[expertise][milestone.title].subMilestones,
                                [subMilestone.id]: checked
                            }
                        }
                    }
                }));
            };

            const renderMilestoneContent = (expertise) => {
                const milestones = data.filter(m => m.title === expertise);
                return React.createElement('div', { style: { marginTop: '16px' } },
                    milestones.map(milestone =>
                        React.createElement('div', {
                            key: milestone.title,
                            style: { marginBottom: '24px' }
                        },
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    alignItems: 'center',
                                    marginBottom: '8px'
                                }
                            },
                                React.createElement(Checkbox, {
                                    checked: selections[expertise][milestone.title]?.selected,
                                    onChange: (e) => handleMilestoneChange(expertise, milestone, e.target.checked)
                                }),
                                React.createElement('span', {
                                    style: {
                                        marginLeft: '8px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }
                                },
                                    milestone.icon,
                                    React.createElement('strong', null, milestone.title)
                                )
                            ),
                            React.createElement('div', {
                                style: { marginLeft: '32px' }
                            },
                                milestone.subMilestones.map(subMilestone =>
                                    React.createElement('div', {
                                        key: subMilestone.id,
                                        style: {
                                            marginBottom: '8px',
                                            display: 'flex',
                                            alignItems: 'center'
                                        }
                                    },
                                        React.createElement(Checkbox, {
                                            checked: selections[expertise][milestone.title]?.subMilestones[subMilestone.id],
                                            onChange: (e) => handleSubMilestoneChange(expertise, milestone, subMilestone, e.target.checked),
                                            disabled: !selections[expertise][milestone.title]?.selected
                                        }),
                                        React.createElement('span', {
                                            style: {
                                                marginLeft: '8px',
                                                color: selections[expertise][milestone.title]?.selected ? 'inherit' : '#999'
                                            }
                                        }, subMilestone.title)
                                    )
                                )
                            )
                        )
                    )
                );
            };

            const handleSaveTemplate = () => {
                if (templateName) {
                    // Ici, vous pouvez ajouter la logique pour sauvegarder le template
                    console.log('Saving template:', {
                        name: templateName,
                        selections
                    });
                    setShowSaveTemplate(false);
                    setTemplateName('');
                    onClose();
                }
            };

            return React.createElement(Drawer, {
                title: 'Configuration des jalons par expertise',
                placement: 'right',
                onClose: onClose,
                open: visible,
                width: 520,
                footer: showSaveTemplate ? React.createElement('div', {
                    style: {
                        display: 'flex',
                        gap: '8px',
                        alignItems: 'center'
                    }
                },
                    React.createElement(Input, {
                        placeholder: 'Nom du template',
                        value: templateName,
                        onChange: e => setTemplateName(e.target.value),
                        style: { flex: 1 }
                    }),
                    React.createElement(Button, {
                        type: 'primary',
                        onClick: handleSaveTemplate,
                        disabled: !templateName
                    }, 'Enregistrer')
                ) : React.createElement('div', {
                    style: {
                        display: 'flex',
                        justifyContent: 'space-between'
                    }
                },
                    React.createElement(Button, {
                        onClick: onClose
                    }, 'Annuler'),
                    React.createElement(Button, {
                        type: 'primary',
                        onClick: () => setShowSaveTemplate(true)
                    }, 'Enregistrer comme template')
                )
            },
                React.createElement(Tabs, {
                    activeKey: selectedExpertise,
                    onChange: setSelectedExpertise,
                    items: [
                        {
                            key: 'Safety',
                            label: '🔒 Safety',
                            children: renderMilestoneContent('Safety')
                        },
                        {
                            key: 'Microbio',
                            label: '🔬 Microbio',
                            children: renderMilestoneContent('Microbio')
                        },
                        {
                            key: 'Performance',
                            label: '⚡ Performance',
                            children: renderMilestoneContent('Performance')
                        }
                    ]
                })
            );
        }

        // Définition des expertises mutualisée
        const expertiseTypes = [
            {
                key: 'safety',
                label: 'Safety',
                icon: '🔒',
                subTypes: [
                    { 
                        key: 'amm', 
                        label: 'AMM',
                        subMilestones: [
                            { key: 'safety_m1', label: 'Screening de sécurité' },
                            { key: 'safety_m2', label: 'Évaluation finale' }
                        ]
                    },
                    { 
                        key: 'tolerance', 
                        label: 'Tolérance',
                        subMilestones: [
                            { key: 'tolerance_m1', label: 'Irritation cutanée' },
                            { key: 'tolerance_m2', label: 'Sensibilisation' }
                        ]
                    },
                    { 
                        key: 'efficacy', 
                        label: 'Efficacité',
                        subMilestones: [
                            { key: 'efficacy_m1', label: 'Tests cliniques' },
                            { key: 'efficacy_m2', label: 'Tests d\'usage' }
                        ]
                    }
                ]
            },
            {
                key: 'microbio',
                label: 'Microbio',
                icon: '🔬',
                subTypes: [
                    { 
                        key: 'culture', 
                        label: 'Culture',
                        subMilestones: [
                            { key: 'culture_m1', label: 'Test de conservation' },
                            { key: 'culture_m2', label: 'Challenge test' }
                        ]
                    },
                    { 
                        key: 'contamination', 
                        label: 'Contamination',
                        subMilestones: [
                            { key: 'contamination_m1', label: 'Test de stabilité' },
                            { key: 'contamination_m2', label: 'Analyse microbiologique' }
                        ]
                    },
                    { 
                        key: 'stabilite', 
                        label: 'Stabilité',
                        subMilestones: [
                            { key: 'stabilite_m1', label: 'Test accéléré' },
                            { key: 'stabilite_m2', label: 'Test longue durée' }
                        ]
                    }
                ]
            },
            {
                key: 'performance',
                label: 'Performance',
                icon: '⚡',
                subTypes: [
                    { 
                        key: 'coloration', 
                        label: 'Coloration',
                        subMilestones: [
                            { key: 'coloration_m1', label: 'Intensité' },
                            { key: 'coloration_m2', label: 'Résistance' }
                        ]
                    },
                    { 
                        key: 'soin', 
                        label: 'Soin',
                        subMilestones: [
                            { key: 'soin_m1', label: 'Hydratation' },
                            { key: 'soin_m2', label: 'Protection' }
                        ]
                    }
                ]
            }
        ];

        // Fonction utilitaire pour créer un menu d'expertise à 3 niveaux
        const createExpertiseSubmenu = (onItemClick) => {
            // Transforme la structure expertiseTypes en format de menu Ant Design
            return expertiseTypes.map(expertType => ({
                key: expertType.key,
                label: expertType.icon + ' ' + expertType.label,
                children: expertType.subTypes.map(subType => ({
                    key: expertType.key + '_' + subType.key,
                    label: subType.label,
                    children: subType.subMilestones.map(milestone => ({
                        key: milestone.key,
                        label: milestone.label,
                        onClick: (e) => {
                            e.domEvent.stopPropagation();
                            onItemClick && onItemClick({
                                expertiseType: expertType.key,
                                expertiseSubType: subType.key,
                                milestone: milestone.key,
                                path: `${expertType.label} > ${subType.label} > ${milestone.label}`
                            });
                        }
                    }))
                }))
            }));
        };

        // Gestionnaire d'événements pour les clics sur les items du menu d'expertise
        const handleExpertiseRequest = (expertiseData) => {
            console.log('Expertise requested:', expertiseData);
            // Ici vous implémenteriez le traitement de la demande d'expertise
            // Par exemple, appel API, ouverture d'un formulaire, etc.
        };

        function App() {
            const [drawerVisible, setDrawerVisible] = React.useState(false);
            const [selectedItem, setSelectedItem] = React.useState(null);
            const [pinnedFormulas, setPinnedFormulas] = React.useState({});
            const [isPinning, setIsPinning] = React.useState(false);
            const [formulaToPinData, setFormulaToPinData] = React.useState(null);
            const [templateDrawerVisible, setTemplateDrawerVisible] = React.useState(false);
            const [subMilestoneDrawerVisible, setSubMilestoneDrawerVisible] = React.useState(false);
            const [concludeDrawerVisible, setConcludeDrawerVisible] = React.useState(false);
            const [selectedMilestone, setSelectedMilestone] = React.useState(null);
            const [starFormulas, setStarFormulas] = React.useState(new Set());
            const [selectedFormulas, setSelectedFormulas] = React.useState(new Set());
            const [templates, setTemplates] = React.useState([
                { name: 'Template standard (tous jalons)', value: 'standard' },
                { name: 'Template minimal (jalons obligatoires)', value: 'minimal' }
            ]);
            const [aiStrategyDrawerVisible, setAiStrategyDrawerVisible] = React.useState(false);
            const [aiStartingPointDrawerVisible, setAiStartingPointDrawerVisible] = React.useState(false);
            const [aiRiskAnalysisDrawerVisible, setAiRiskAnalysisDrawerVisible] = React.useState(false);
            const [aiProjectRiskAnalysisDrawerVisible, setAiProjectRiskAnalysisDrawerVisible] = React.useState(false);
            const [aiProjectReportDrawerVisible, setAiProjectReportDrawerVisible] = React.useState(false);
            const [aiContext, setAiContext] = React.useState(null);

            // Gestion de la sélection des formules
            const handleFormulaSelect = (formulaId, checked) => {
                setSelectedFormulas(prev => {
                    const newSet = new Set(prev);
                    if (checked) {
                        newSet.add(formulaId);
                    } else {
                        newSet.delete(formulaId);
                    }
                    return newSet;
                });
            };

            // Barre d'actions contextuelle pour les formules sélectionnées
            const ActionsBar = () => {
                if (selectedFormulas.size === 0) return null;

                const AiMenu = React.createElement(Menu, {
                    items: [
                        {
                            key: 'strategy',
                            label: 'Compagnon de stratégie formulatoire',
                            icon: '💡',
                            onClick: () => setAiStrategyDrawerVisible(true)
                        },
                        {
                            key: 'starting-point',
                            label: 'Compagnon de recherche de starting point',
                            icon: '🎯',
                            onClick: () => setAiStartingPointDrawerVisible(true)
                        }
                    ]
                });

                // Variable pour le menu d'expertise
                const globalExpertiseMenu = React.createElement(Menu, {
                    items: createExpertiseSubmenu(handleExpertiseRequest)
                });

                // Pour la demande d'expertise dans la barre d'actions, utiliser la même structure
                const actionButtons = [
                    { icon: '🤖', label: 'Assistant IA', type: 'primary', isDropdown: true, overlay: AiMenu },
                    { icon: '🔬', label: 'Simuler' },
                    { icon: '⚗️', label: 'Fabriquer' },
                    { icon: '📋', label: 'Lancer étude' },
                    { icon: '⚖️', label: 'Comparer' },
                    { icon: '📝', label: 'Demande d\'expertise', isDropdown: true, overlay: globalExpertiseMenu },
                    { icon: '✨', label: 'Officialiser', type: 'primary' }
                ];

                return React.createElement('div', {
                    style: {
                        position: 'fixed',
                        bottom: '24px',
                        left: '50%',
                        transform: 'translateX(-50%)',
                        background: 'white',
                        padding: '12px 24px',
                        borderRadius: '8px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
                        display: 'flex',
                        gap: '16px',
                        alignItems: 'center',
                        zIndex: 1000
                    }
                },
                    React.createElement('span', null, 
                        `${selectedFormulas.size} formule(s) sélectionnée(s)`
                    ),
                    ...actionButtons.map(button => 
                        button.isDropdown ?
                            React.createElement(Dropdown, {
                                overlay: button.overlay,
                                trigger: ['click']
                            },
                                React.createElement(Button, {
                                    icon: button.icon,
                                    type: button.type
                                }, button.label)
                            )
                            :
                            React.createElement(Button, {
                                icon: button.icon,
                                type: button.type
                            }, button.label)
                    )
                );
            };

            // Initialiser les données avec la conclusion
            const initialData = data.map(item => {
                if (item.title === 'Microbio') {
                    return {
                        ...item,
                        conclusion: {
                            status: 'A risque',
                            comment: 'Très sensible à la variation de lots de matière première'
                        }
                    };
                }
                return item;
            });

            const handleSetStarFormula = (formulaId) => {
                setStarFormulas(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(formulaId)) {
                        newSet.delete(formulaId);
                    } else {
                        newSet.add(formulaId);
                    }
                    return newSet;
                });
            };

            const handleCommentClick = (item) => {
                setIsPinning(false);
                setSelectedItem(item);
                setDrawerVisible(true);
            };

            const handleItemClick = (item) => {
                setSelectedItem(item === selectedItem ? null : item);
            };

            const handlePinFormula = (formula, milestone) => {
                setIsPinning(true);
                setFormulaToPinData({
                    formula,
                    milestone: milestone.title,
                    subMilestone: milestone.subMilestone?.id
                });
                setSelectedItem({
                    ...formula,
                    milestone: milestone.title,
                    subMilestone: milestone.subMilestone?.title
                });
                setDrawerVisible(true);
            };

            const handlePinConfirm = () => {
                if (formulaToPinData) {
                    const pinKey = `${formulaToPinData.milestone}:${formulaToPinData.subMilestone || ''}`;
                    setPinnedFormulas(prev => ({
                        ...prev,
                        [pinKey]: formulaToPinData.formula.id
                    }));
                }
                setFormulaToPinData(null);
                setIsPinning(false);
            };

            // Helper function to get list of milestones where a formula is pinned
            const getPinnedMilestones = (formulaId) => {
                return Object.entries(pinnedFormulas)
                    .filter(([_, pinned]) => pinned === formulaId)
                    .map(([key]) => {
                        const [milestone, subMilestone] = key.split(':');
                        return {
                            milestone,
                            subMilestone
                        };
                    });
            };

            const handleTemplateChange = (value) => {
                if (value === 'save') {
                    setTemplateDrawerVisible(true);
                } else {
                    // Logic for loading template
                    console.log('Loading template:', value);
                    
                    // Exemple de manipulation de templates spécifiques
                    if (value === 'colo_oxydation') {
                        console.log('Loading oxidation coloration template');
                        // Ici on chargerait la configuration spécifique
                    } else if (value === 'colo_naturelle') {
                        console.log('Loading natural coloration template');
                        // Ici on chargerait la configuration spécifique
                    }
                }
            };

            const handleTemplateSave = (template) => {
                setTemplates(prev => [
                    ...prev,
                    { name: template.name, value: template.name.toLowerCase().replace(/\s+/g, '_') }
                ]);
                // Here you would also save the template configuration (template.milestones)
                console.log('Saving template:', template);
            };

            const templateOptions = [
                { 
                    label: React.createElement('div', { style: { fontWeight: 'bold' } }, 'Sélectionner un template'),
                    options: [
                        { label: 'Template standard (tous jalons)', value: 'standard' },
                        { label: 'Template minimal (jalons obligatoires)', value: 'minimal' }
                    ]
                },
                {
                    label: React.createElement('div', { style: { fontWeight: 'bold' } }, 'Mon labo'),
                    options: [
                        { label: 'Template pour coloration d\'oxydation', value: 'colo_oxydation' },
                        { label: 'Template pour coloration naturelle', value: 'colo_naturelle' }
                    ]
                },
                {
                    type: 'divider'
                },
                {
                    label: 'Gérer les jalons',
                    value: 'save'
                }
            ];

            const tabs = [
                {
                    key: '1',
                    label: '1. Cards + Progress',
                    children: React.createElement(ChecklistView, { 
                        data: initialData,
                        onCommentClick: handleCommentClick,
                        onItemClick: handleItemClick,
                        selectedItem: selectedItem
                    })
                },
                {
                    key: '2',
                    label: '2. Statistiques compactes',
                    children: React.createElement(StatisticsView, { data: initialData })
                },
                {
                    key: '3',
                    label: '3. Badges avec icônes',
                    children: React.createElement(BadgesView, { data: initialData })
                }
            ];

            const handleConcludeSubmit = (data) => {
                setSelectedItem(prev => ({
                    ...prev,
                    conclusion: data
                }));
                setConcludeDrawerVisible(false);
            };

            // AI Strategy Dialog Component
            const AiStrategyDrawer = ({ visible, onClose, formulas, briefData }) => {
                const [selectedFormulas, setSelectedFormulas] = React.useState(formulas);
                const [selectedPriorities, setSelectedPriorities] = React.useState(['performance', 'security', 'cost']);
                const [userProblem, setUserProblem] = React.useState('');
                const [aiResponse, setAiResponse] = React.useState('');

                const handleSubmit = () => {
                    const context = `
                        Formules sélectionnées:
                        ${selectedFormulas.map(f => `- ${f.id}: ${f.name} (${f.results.performance.map(p => `${p.name}: ${p.value}`).join(', ')})`).join('\n')}

                        Priorités sélectionnées:
                        ${selectedPriorities.join(', ')}

                        Problématique utilisateur:
                        ${userProblem}
                    `;
                    
                    console.log('Sending to AI:', context);
                    setAiResponse("Analyse en cours...");
                };

                return React.createElement(Drawer, {
                    title: '💡 Compagnon de stratégie formulatoire',
                    placement: 'right',
                    width: 600,
                    onClose: onClose,
                    open: visible,
                    extra: React.createElement(Button, {
                        type: 'primary',
                        onClick: handleSubmit,
                        disabled: !userProblem || (selectedFormulas.length === 0 && selectedPriorities.length === 0)
                    }, 'Analyser')
                },
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '24px'
                        }
                    },
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Formules à analyser'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                formulas.map(f => React.createElement(Tag.CheckableTag, {
                                    key: f.id,
                                    checked: selectedFormulas.some(sf => sf.id === f.id),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedFormulas([...selectedFormulas, f]);
                                        } else {
                                            setSelectedFormulas(selectedFormulas.filter(sf => sf.id !== f.id));
                                        }
                                    }
                                }, `${f.id}: ${f.name}`))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Axes du brief'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                [
                                    { label: '⚡ Performance', value: 'performance' },
                                    { label: '🌱 Green & Sécurisation', value: 'security' },
                                    { label: '💰 Coût', value: 'cost' },
                                    { label: '🎨 Couleur', value: 'color' }
                                ].map(priority => React.createElement(Tag.CheckableTag, {
                                    key: priority.value,
                                    checked: selectedPriorities.includes(priority.value),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedPriorities([...selectedPriorities, priority.value]);
                                        } else {
                                            setSelectedPriorities(selectedPriorities.filter(p => p !== priority.value));
                                        }
                                    }
                                }, priority.label))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Décrivez votre problématique'),
                            React.createElement(Input.TextArea, {
                                rows: 4,
                                value: userProblem,
                                onChange: (e) => setUserProblem(e.target.value),
                                placeholder: 'Ex: Comment améliorer la sélectivité tout en maintenant le coût...'
                            })
                        ),
                        aiResponse && React.createElement('div', {
                            style: {
                                marginTop: '16px',
                                padding: '16px',
                                background: '#f5f5f5',
                                borderRadius: '8px'
                            }
                        },
                            React.createElement('h4', null, 'Analyse IA'),
                            React.createElement('div', null, aiResponse)
                        )
                    )
                );
            };

            // AI Starting Point Dialog Component
            const AiStartingPointDrawer = ({ visible, onClose, formulas, briefData }) => {
                const [selectedFormulas, setSelectedFormulas] = React.useState(formulas);
                const [selectedPriorities, setSelectedPriorities] = React.useState(['performance', 'security', 'cost']);
                const [userProblem, setUserProblem] = React.useState('');
                const [aiResponse, setAiResponse] = React.useState('');

                const handleSubmit = () => {
                    const context = `
                        Formules de référence:
                        ${selectedFormulas.map(f => `- ${f.id}: ${f.name} (${f.results.performance.map(p => `${p.name}: ${p.value}`).join(', ')})`).join('\n')}

                        Priorités sélectionnées:
                        ${selectedPriorities.join(', ')}

                        Objectif de recherche:
                        ${userProblem}
                    `;
                    
                    console.log('Sending to AI:', context);
                    setAiResponse("Recherche de starting points...");
                };

                return React.createElement(Drawer, {
                    title: '🎯 Compagnon de recherche de starting point',
                    placement: 'right',
                    width: 600,
                    onClose: onClose,
                    open: visible,
                    extra: React.createElement(Button, {
                        type: 'primary',
                        onClick: handleSubmit,
                        disabled: !userProblem || (selectedFormulas.length === 0 && selectedPriorities.length === 0)
                    }, 'Rechercher')
                },
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '24px'
                        }
                    },
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Formules de référence'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                formulas.map(f => React.createElement(Tag.CheckableTag, {
                                    key: f.id,
                                    checked: selectedFormulas.some(sf => sf.id === f.id),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedFormulas([...selectedFormulas, f]);
                                        } else {
                                            setSelectedFormulas(selectedFormulas.filter(sf => sf.id !== f.id));
                                        }
                                    }
                                }, `${f.id}: ${f.name}`))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Axes du brief'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                [
                                    { label: '⚡ Performance', value: 'performance' },
                                    { label: '🌱 Green & Sécurisation', value: 'security' },
                                    { label: '💰 Coût', value: 'cost' },
                                    { label: '🎨 Couleur', value: 'color' }
                                ].map(priority => React.createElement(Tag.CheckableTag, {
                                    key: priority.value,
                                    checked: selectedPriorities.includes(priority.value),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedPriorities([...selectedPriorities, priority.value]);
                                        } else {
                                            setSelectedPriorities(selectedPriorities.filter(p => p !== priority.value));
                                        }
                                    }
                                }, priority.label))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Décrivez votre objectif de recherche'),
                            React.createElement(Input.TextArea, {
                                rows: 4,
                                value: userProblem,
                                onChange: (e) => setUserProblem(e.target.value),
                                placeholder: 'Ex: Rechercher un starting point avec une meilleure biodégradabilité...'
                            })
                        ),
                        aiResponse && React.createElement('div', {
                            style: {
                                marginTop: '16px',
                                padding: '16px',
                                background: '#f5f5f5',
                                borderRadius: '8px'
                            }
                        },
                            React.createElement('h4', null, 'Suggestions IA'),
                            React.createElement('div', null, aiResponse)
                        )
                    )
                );
            };

            // AI Risk Analysis Dialog Component
            const AiRiskAnalysisDrawer = ({ visible, onClose, formulas, briefData }) => {
                const [selectedFormulas, setSelectedFormulas] = React.useState(formulas);
                const [selectedPriorities, setSelectedPriorities] = React.useState(['performance', 'security', 'cost']);
                const [userProblem, setUserProblem] = React.useState('');
                const [aiResponse, setAiResponse] = React.useState('');

                const handleSubmit = () => {
                    const context = `
                        Formules sélectionnées:
                        ${selectedFormulas.map(f => `- ${f.id}: ${f.name} (${f.results.performance.map(p => `${p.name}: ${p.value}`).join(', ')})`).join('\n')}

                        Priorités sélectionnées:
                        ${selectedPriorities.join(', ')}

                        Objectif d'analyse:
                        ${userProblem}
                    `;
                    
                    console.log('Sending to AI:', context);
                    setAiResponse("Analyse des risques en cours...");
                };

                return React.createElement(Drawer, {
                    title: '⚠️ Analyse des risques de formules',
                    placement: 'right',
                    width: 600,
                    onClose: onClose,
                    open: visible,
                    extra: React.createElement(Button, {
                        type: 'primary',
                        onClick: handleSubmit,
                        disabled: !userProblem || (selectedFormulas.length === 0 && selectedPriorities.length === 0)
                    }, 'Analyser')
                },
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '24px'
                        }
                    },
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Formules à analyser'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                formulas.map(f => React.createElement(Tag.CheckableTag, {
                                    key: f.id,
                                    checked: selectedFormulas.some(sf => sf.id === f.id),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedFormulas([...selectedFormulas, f]);
                                        } else {
                                            setSelectedFormulas(selectedFormulas.filter(sf => sf.id !== f.id));
                                        }
                                    }
                                }, `${f.id}: ${f.name}`))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Axes du brief'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                [
                                    { label: '⚡ Performance', value: 'performance' },
                                    { label: '🌱 Green & Sécurisation', value: 'security' },
                                    { label: '💰 Coût', value: 'cost' },
                                    { label: '🎨 Couleur', value: 'color' }
                                ].map(priority => React.createElement(Tag.CheckableTag, {
                                    key: priority.value,
                                    checked: selectedPriorities.includes(priority.value),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedPriorities([...selectedPriorities, priority.value]);
                                        } else {
                                            setSelectedPriorities(selectedPriorities.filter(p => p !== priority.value));
                                        }
                                    }
                                }, priority.label))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Décrivez votre objectif d\'analyse'),
                            React.createElement(Input.TextArea, {
                                rows: 4,
                                value: userProblem,
                                onChange: (e) => setUserProblem(e.target.value),
                                placeholder: 'Ex: Analyser les risques de ma formule star par rapport aux formules de référence en termes de performance et de sécurité...'
                            })
                        ),
                        aiResponse && React.createElement('div', {
                            style: {
                                marginTop: '16px',
                                padding: '16px',
                                background: '#f5f5f5',
                                borderRadius: '8px'
                            }
                        },
                            React.createElement('h4', null, 'Analyse des risques'),
                            React.createElement('div', null, aiResponse)
                        )
                    )
                );
            };

            // AI Project Risk Analysis Dialog Component
            const AiProjectRiskAnalysisDrawer = ({ visible, onClose, briefData, milestones, formulas }) => {
                const [selectedMilestones, setSelectedMilestones] = React.useState([]);
                const [selectedPriorities, setSelectedPriorities] = React.useState(['performance', 'security', 'cost']);
                const [userProblem, setUserProblem] = React.useState('');
                const [aiResponse, setAiResponse] = React.useState('');
                const [referenceFormulas, setReferenceFormulas] = React.useState([]);
                const [expandedFormula, setExpandedFormula] = React.useState(null);
                const [showExcelAnalysis, setShowExcelAnalysis] = React.useState(false);
                const [isTyping, setIsTyping] = React.useState(false);
                const [currentTypingIndex, setCurrentTypingIndex] = React.useState(0);
                const [excelData, setExcelData] = React.useState('');
                const [uploadedFile, setUploadedFile] = React.useState(null);
                const [showUploadModal, setShowUploadModal] = React.useState(false);
                const [uploadedExcelData, setUploadedExcelData] = React.useState('');
                const [useUploadedData, setUseUploadedData] = React.useState(false);
                const fileInputRef = React.useRef(null);

                // Exemple de données d'analyse de risque au format CSV/Excel pour l'effet wow
                const sampleExcelRiskAnalysis = `Jalon,Sous-jalon,Risque identifié,Probabilité,Impact,Score total,Actions préventives,Actions correctives,Statut

Safety,AMM,Non-conformité réglementaire,3,5,15,Veille réglementaire renforcée,Revue d'expert externe,À risque
Safety,AMM,Réaction inattendue des ingrédients,2,4,8,Tests de compatibilité additionnels,Reformulation ciblée,Surveillé
Safety,Tolérance,Sensibilisation cutanée,3,5,15,Utiliser des ingrédients moins sensibilisants,Tests cliniques supplémentaires,À risque
Safety,Tolérance,Irritation cutanée,2,3,6,Ajuster pH et solvants,Ajout d'agents apaisant,Surveillé

Microbio,Culture,Contamination en cours de fabrication,1,5,5,Renforcément protocoles d'asepsie,Analyse lots supplémentaires,Surveillé
Microbio,Culture,Croissance bactérienne accélérée,2,4,8,Optimisation du système conservateur,Nouveau Challenge test,Surveillé
Microbio,Stabilité,Dégradation prématurée,4,3,12,Stabilisants additionnels,Tests de stabilité accélérés,À risque
Microbio,Stabilité,Variation de viscosité,2,2,4,Ajustement des rhéologiques,Reformulation émulsion,Acceptable

Performance,Coloration,Faible intensité,3,4,12,Optimisation des pigments,Ajustement des concentrations,À risque
Performance,Coloration,Décoloration prématurée,2,5,10,Agents fixateurs supplémentaires,Nouveaux tests de durabilité,Surveillé
Performance,Soin,Performance hydratation insuffisante,2,3,6,Renforcement des humectants,Ajout d'émollients,Surveillé

Coût,Matières premières,Variation prix matières premières,4,3,12,Contrats long terme fournisseurs,Alternatives préqualifiées,À risque
Coût,Fabrication,Rendement de production sous objectif,3,4,12,Optimisation procédé,Revue industrialisation,À risque`;

                React.useEffect(() => {
                    if (visible) {
                        // Par défaut, sélectionnez tous les jalons disponibles
                        setSelectedMilestones(milestones.map(m => m.title));
                        
                        // Sélectionner par défaut les formules marquées comme star et la formule initiale
                        if (formulas) {
                            const defaultReferences = formulas.filter(f => 
                                f.type === 'star' || f.type === 'initial'
                            );
                            setReferenceFormulas(defaultReferences.length > 0 ? defaultReferences : [formulas[0]]);
                        }
                        
                        // Réinitialiser l'état de l'analyse Excel
                        setShowExcelAnalysis(false);
                        setIsTyping(false);
                        setExcelData('');
                        setUploadedFile(null);
                        setUploadedExcelData('');
                        setUseUploadedData(false);
                    }
                }, [visible, milestones, formulas]);

                // Handler pour l'upload de fichier
                const handleFileUpload = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    setUploadedFile(file);
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const content = event.target.result;
                        setUploadedExcelData(content);
                        setShowUploadModal(true);
                    };
                    
                    reader.readAsText(file);
                };
                
                // Handler pour utiliser les données téléversées
                const handleUseUploadedData = () => {
                    setUseUploadedData(true);
                    setExcelData(uploadedExcelData);
                    setShowExcelAnalysis(true);
                    setIsTyping(false);
                    setShowUploadModal(false);
                };
                
                // Modal pour prévisualiser et confirmer l'utilisation du fichier téléversé
                const renderUploadModal = () => {
                    if (!showUploadModal) return null;
                    
                    // Convertir les données CSV en tableau pour la prévisualisation
                    const rows = uploadedExcelData.split('\n').filter(row => row.trim() !== '');
                    const headers = rows.length > 0 ? rows[0].split(',') : [];
                    const dataRows = rows.length > 1 ? rows.slice(1) : [];
                    
                    // Styles pour la modal
                    const modalStyle = {
                        position: 'fixed',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        backgroundColor: 'rgba(0, 0, 0, 0.5)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        zIndex: 1000
                    };
                    
                    const modalContentStyle = {
                        backgroundColor: '#fff',
                        borderRadius: '8px',
                        boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
                        width: '80%',
                        maxWidth: '900px',
                        maxHeight: '80vh',
                        overflow: 'hidden',
                        display: 'flex',
                        flexDirection: 'column'
                    };
                    
                    const modalHeaderStyle = {
                        padding: '16px 24px',
                        borderBottom: '1px solid #f0f0f0',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    };
                    
                    const modalBodyStyle = {
                        padding: '24px',
                        overflowY: 'auto',
                        maxHeight: '60vh'
                    };
                    
                    const modalFooterStyle = {
                        padding: '16px 24px',
                        borderTop: '1px solid #f0f0f0',
                        display: 'flex',
                        justifyContent: 'flex-end',
                        gap: '8px'
                    };
                    
                    return React.createElement('div', { style: modalStyle },
                        React.createElement('div', { style: modalContentStyle },
                            React.createElement('div', { style: modalHeaderStyle },
                                React.createElement('h3', { style: { margin: 0 } }, `Prévisualisation du fichier: ${uploadedFile?.name}`),
                                React.createElement(Button, {
                                    type: 'text',
                                    icon: '✖️',
                                    onClick: () => setShowUploadModal(false)
                                })
                            ),
                            React.createElement('div', { style: modalBodyStyle },
                                React.createElement('table', {
                                    style: {
                                        width: '100%',
                                        borderCollapse: 'collapse',
                                        borderSpacing: 0
                                    }
                                },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            headers.map((header, index) => 
                                                React.createElement('th', {
                                                    key: index,
                                                    style: {
                                                        backgroundColor: '#f0f0f0',
                                                        fontWeight: 'bold',
                                                        padding: '8px',
                                                        borderBottom: '2px solid #d9d9d9',
                                                        textAlign: 'left'
                                                    }
                                                }, header)
                                            )
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        dataRows.slice(0, 10).map((row, rowIndex) => {
                                            const cells = row.split(',');
                                            return React.createElement('tr', {
                                                key: rowIndex,
                                                style: {
                                                    backgroundColor: rowIndex % 2 === 0 ? '#ffffff' : '#fafafa'
                                                }
                                            },
                                                cells.map((cell, cellIndex) => 
                                                    React.createElement('td', {
                                                        key: cellIndex,
                                                        style: {
                                                            padding: '8px',
                                                            borderBottom: '1px solid #e8e8e8'
                                                        }
                                                    }, cell)
                                                )
                                            );
                                        })
                                    )
                                ),
                                dataRows.length > 10 && React.createElement('div', {
                                    style: { 
                                        padding: '12px 0',
                                        textAlign: 'center',
                                        color: '#888'
                                    }
                                }, `+ ${dataRows.length - 10} autres lignes non affichées dans la prévisualisation`)
                            ),
                            React.createElement('div', { style: modalFooterStyle },
                                React.createElement(Button, {
                                    onClick: () => setShowUploadModal(false)
                                }, 'Annuler'),
                                React.createElement(Button, {
                                    type: 'primary',
                                    onClick: handleUseUploadedData
                                }, 'Utiliser ces données')
                            )
                        )
                    );
                };

                const handleSubmit = () => {
                    // Si on a des données téléversées et qu'on souhaite les utiliser, 
                    // pas besoin de générer l'analyse
                    if (uploadedFile && !showExcelAnalysis) {
                        setShowExcelAnalysis(true);
                        setExcelData(uploadedExcelData);
                        setIsTyping(false);
                        return;
                    }
                    
                    const context = `
                        Jalons sélectionnés:
                        ${selectedMilestones.join(', ')}

                        Formules de référence:
                        ${referenceFormulas.map(f => `- ${f.id}: ${f.name}`).join('\n')}

                        Priorités sélectionnées:
                        ${selectedPriorities.join(', ')}

                        Objectif d'analyse:
                        ${userProblem}
                    `;
                    
                    console.log('Sending to AI:', context);
                    setAiResponse("Analyse des risques du projet en cours...");
                    
                    // Lancer l'animation de génération de l'analyse Excel de risque
                    setShowExcelAnalysis(true);
                    setIsTyping(true);
                    setCurrentTypingIndex(0);
                    setExcelData('');
                    
                    // Simuler la génération progressive de l'analyse Excel
                    let index = 0;
                    const typingInterval = setInterval(() => {
                        if (index < sampleExcelRiskAnalysis.length) {
                            setExcelData(prevData => prevData + sampleExcelRiskAnalysis.charAt(index));
                            index++;
                            setCurrentTypingIndex(index);
                        } else {
                            clearInterval(typingInterval);
                            setIsTyping(false);
                        }
                    }, 10); // Vitesse d'écriture
                    
                    return () => clearInterval(typingInterval);
                };
                
                // Rendu de l'analyse de risque Excel
                const renderExcelAnalysis = () => {
                    if (!showExcelAnalysis) return null;
                    
                    // Convertir les données CSV en tableau pour l'affichage
                    const rows = excelData.split('\n').filter(row => row.trim() !== '');
                    const headers = rows.length > 0 ? rows[0].split(',') : [];
                    const dataRows = rows.length > 1 ? rows.slice(1) : [];
                    
                    // Style pour les cellules d'en-tête du tableau
                    const thStyle = {
                        backgroundColor: '#f0f0f0',
                        fontWeight: 'bold',
                        padding: '8px',
                        borderBottom: '2px solid #d9d9d9',
                        textAlign: 'left',
                        position: 'sticky',
                        top: 0,
                        zIndex: 1
                    };
                    
                    // Style pour les cellules du tableau
                    const tdStyle = {
                        padding: '8px',
                        borderBottom: '1px solid #e8e8e8',
                        borderRight: '1px solid #e8e8e8'
                    };
                    
                    // Style spécifique pour les statuts
                    const getStatusStyle = (status) => {
                        switch (status.trim().toLowerCase()) {
                            case 'à risque':
                                return { backgroundColor: '#ffccc7', color: '#a8071a' };
                            case 'surveillé':
                                return { backgroundColor: '#fffbe6', color: '#ad8b00' };
                            case 'acceptable':
                                return { backgroundColor: '#d9f7be', color: '#389e0d' };
                            default:
                                return {};
                        }
                    };
                    
                    return React.createElement('div', {
                        style: {
                            marginTop: '24px',
                            marginBottom: '16px',
                            background: 'white',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
                            borderRadius: '8px',
                            overflow: 'hidden'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                padding: '12px 16px',
                                borderBottom: '1px solid #e8e8e8',
                                backgroundColor: '#fafafa'
                            }
                        },
                            React.createElement('h3', {
                                style: {
                                    margin: 0,
                                    fontSize: '16px'
                                }
                            }, 'Analyse de risque détaillée'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '8px'
                                }
                            },
                                !isTyping && React.createElement(Button, {
                                    type: 'primary',
                                    icon: '📥',
                                    size: 'small',
                                    style: {
                                        background: '#52c41a',
                                        borderColor: '#52c41a'
                                    },
                                    onClick: () => {
                                        // Créer un blob avec le contenu CSV
                                        const blob = new Blob([excelData], { type: 'text/csv;charset=utf-8;' });
                                        const url = URL.createObjectURL(blob);
                                        
                                        // Créer un élément a temporaire et simuler un clic
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = `Analyse_Risque_${new Date().toISOString().slice(0, 10)}.csv`;
                                        document.body.appendChild(a);
                                        a.click();
                                        
                                        // Nettoyer
                                        setTimeout(() => {
                                            document.body.removeChild(a);
                                            URL.revokeObjectURL(url);
                                        }, 0);
                                    }
                                }, 'Télécharger CSV'),
                                !isTyping && React.createElement(Button, {
                                    type: 'primary',
                                    icon: '📊',
                                    size: 'small',
                                    onClick: () => {
                                        console.log('Génération du rapport basé sur l\'analyse Excel');
                                    }
                                }, 'Générer rapport')
                            )
                        ),
                        React.createElement('div', {
                            style: {
                                overflowX: 'auto',
                                maxHeight: '400px'
                            }
                        },
                            isTyping && !rows.length ? 
                                React.createElement('div', {
                                    style: {
                                        padding: '20px',
                                        textAlign: 'center',
                                        color: '#1890ff'
                                    }
                                }, "Génération de l'analyse en cours...") :
                                React.createElement('table', {
                                    style: {
                                        width: '100%',
                                        borderCollapse: 'collapse',
                                        borderSpacing: 0,
                                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial'
                                    }
                                },
                                    React.createElement('thead', null,
                                        React.createElement('tr', null,
                                            headers.map((header, index) => 
                                                React.createElement('th', {
                                                    key: index,
                                                    style: thStyle
                                                }, header)
                                            )
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        dataRows.map((row, rowIndex) => {
                                            const cells = row.split(',');
                                            return React.createElement('tr', {
                                                key: rowIndex,
                                                style: {
                                                    backgroundColor: rowIndex % 2 === 0 ? '#ffffff' : '#fafafa'
                                                }
                                            },
                                                cells.map((cell, cellIndex) => {
                                                    // Style spécifique pour la colonne de statut (dernière colonne)
                                                    const isStatusColumn = cellIndex === cells.length - 1;
                                                    const additionalStyle = isStatusColumn ? getStatusStyle(cell) : {};
                                                    
                                                    return React.createElement('td', {
                                                        key: cellIndex,
                                                        style: {
                                                            ...tdStyle,
                                                            ...additionalStyle,
                                                            fontWeight: isStatusColumn ? 'bold' : 'normal'
                                                        }
                                                    }, cell);
                                                })
                                            );
                                        })
                                    )
                                ),
                            isTyping && React.createElement('div', {
                                style: {
                                    display: 'inline-block',
                                    width: '8px',
                                    height: '16px',
                                    backgroundColor: '#1890ff',
                                    animation: 'blink 1s infinite',
                                    marginLeft: '4px',
                                    verticalAlign: 'middle'
                                }
                            })
                        )
                    );
                };

                // Helper fonction pour rendre les expertises d'une formule
                const renderExpertises = (formula) => {
                    if (!formula.expertises || formula.expertises.length === 0) {
                        return React.createElement('div', {
                            style: { color: '#999', fontStyle: 'italic', fontSize: '0.85em' }
                        }, 'Aucune expertise associée');
                    }

                    const expertiseColors = {
                        'Safety': { color: '#ff4d4f', icon: '🔒' },
                        'Microbio': { color: '#52c41a', icon: '🔬' },
                        'Performance': { color: '#1890ff', icon: '⚡' }
                    };

                    const statusIndicators = {
                        'completed': { color: '#52c41a', text: 'Terminé' },
                        'in_progress': { color: '#1890ff', text: 'En cours' },
                        'pending': { color: '#faad14', text: 'En attente' }
                    };

                    return React.createElement('div', {
                        style: { display: 'flex', flexDirection: 'column', gap: '6px', marginTop: '8px' }
                    },
                        formula.expertises.map((exp, index) => {
                            const expertiseStyle = expertiseColors[exp.type] || { color: '#666', icon: '📋' };
                            const statusStyle = statusIndicators[exp.status] || { color: '#666', text: exp.status };
                            
                            let subtype = '';
                            if (exp.type === 'Safety') {
                                subtype = 'AMM';
                            } else if (exp.type === 'Microbio') {
                                subtype = 'Culture';
                            } else if (exp.type === 'Performance') {
                                subtype = 'Coloration';
                            }

                            return React.createElement('div', {
                                key: index,
                                style: {
                                    display: 'flex',
                                    padding: '4px 8px',
                                    backgroundColor: expertiseStyle.color + '11', // Couleur transparente
                                    borderLeft: `4px solid ${expertiseStyle.color}`,
                                    borderRadius: '2px 4px 4px 2px',
                                    alignItems: 'center',
                                    justifyContent: 'space-between'
                                }
                            },
                                React.createElement('div', {
                                    style: { display: 'flex', alignItems: 'center', gap: '6px' }
                                },
                                    React.createElement('span', {
                                        style: { 
                                            display: 'inline-flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            width: '22px',
                                            height: '22px',
                                            borderRadius: '50%',
                                            backgroundColor: expertiseStyle.color,
                                            color: 'white',
                                            fontSize: '0.8em'
                                        }
                                    }, expertiseStyle.icon),
                                    React.createElement('span', null, 
                                        React.createElement('span', { style: { fontWeight: 'bold' } }, exp.type),
                                        subtype ? React.createElement('span', null, ` - ${subtype}`) : null
                                    )
                                ),
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '2px 8px',
                                        backgroundColor: statusStyle.color + '22',
                                        borderRadius: '12px',
                                        fontSize: '0.75em',
                                        color: statusStyle.color,
                                        fontWeight: 'bold'
                                    }
                                }, statusStyle.text)
                            );
                        })
                    );
                };

                return React.createElement(Drawer, {
                    title: '🔍 Analyse des risques projet',
                    placement: 'right',
                    width: 700,
                    onClose: onClose,
                    open: visible,
                    bodyStyle: {
                        padding: '20px',
                        overflow: 'auto'
                    },
                    extra: React.createElement(Button, {
                        type: 'primary',
                        onClick: handleSubmit,
                        disabled: !userProblem || selectedMilestones.length === 0
                    }, 'Analyser')
                },
                    renderUploadModal(),
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '16px'
                        }
                    },
                        // Section pour l'upload d'Excel existant
                        React.createElement('div', null,
                            React.createElement('h4', { 
                                style: { 
                                    display: 'flex', 
                                    alignItems: 'center', 
                                    justifyContent: 'space-between' 
                                } 
                            },
                                React.createElement('span', null, 'Analyse Excel existante'),
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        gap: '8px',
                                        alignItems: 'center'
                                    }
                                },
                                    uploadedFile && React.createElement('span', {
                                        style: { 
                                            fontSize: '12px',
                                            color: '#52c41a'
                                        }
                                    }, '✓ ' + uploadedFile.name),
                                    React.createElement(Button, {
                                        type: 'default',
                                        size: 'small',
                                        icon: '📤',
                                        onClick: () => fileInputRef.current.click()
                                    }, uploadedFile ? 'Changer' : 'Importer')
                                )
                            ),
                            React.createElement('input', {
                                ref: fileInputRef,
                                type: 'file',
                                accept: '.csv,.xls,.xlsx',
                                style: { display: 'none' },
                                onChange: handleFileUpload
                            }),
                            React.createElement('p', {
                                style: {
                                    fontSize: '13px',
                                    color: '#888',
                                    margin: '4px 0 12px'
                                }
                            }, 'Vous pouvez importer une analyse de risque existante au format CSV ou Excel.'),
                            uploadedFile && !showExcelAnalysis && !useUploadedData && React.createElement(Button, {
                                type: 'primary',
                                icon: '📋',
                                style: {
                                    marginTop: '8px'
                                },
                                onClick: () => setShowUploadModal(true)
                            }, 'Prévisualiser')
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Jalons à analyser'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                milestones.map(m => React.createElement(Tag.CheckableTag, {
                                    key: m.title,
                                    checked: selectedMilestones.includes(m.title),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedMilestones([...selectedMilestones, m.title]);
                                        } else {
                                            setSelectedMilestones(selectedMilestones.filter(t => t !== m.title));
                                        }
                                    }
                                }, `${m.icon} ${m.title}`))
                            )
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Formules de référence'),
                            React.createElement('div', {
                                style: {
                                    maxHeight: '250px',
                                    overflowY: 'auto',
                                    background: '#f5f5f5',
                                    borderRadius: '8px',
                                    padding: '4px'
                                }
                            },
                                formulas && formulas.map(formula => {
                                    const isSelected = referenceFormulas.some(rf => rf.id === formula.id);
                                    const isExpanded = expandedFormula === formula.id;
                                    const typeIcons = {
                                        'star': '⭐',
                                        'initial': '🏁',
                                        'regular': ''
                                    };

                                    return React.createElement('div', {
                                        key: formula.id,
                                        style: {
                                            margin: '8px 4px',
                                            borderRadius: '6px',
                                            border: `1px solid ${isSelected ? '#1890ff' : 'transparent'}`,
                                            backgroundColor: isSelected ? 'white' : 'transparent',
                                            overflow: 'hidden',
                                            boxShadow: isSelected ? '0 2px 6px rgba(24, 144, 255, 0.15)' : 'none',
                                            transition: 'all 0.3s ease'
                                        }
                                    },
                                        React.createElement('div', {
                                            style: {
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                padding: '10px 12px',
                                                cursor: 'pointer',
                                                backgroundColor: isSelected ? '#f0f7ff' : '#f0f0f0',
                                                alignItems: 'center'
                                            },
                                            onClick: () => {
                                                if (isSelected) {
                                                    setReferenceFormulas(referenceFormulas.filter(rf => rf.id !== formula.id));
                                                } else {
                                                    setReferenceFormulas([...referenceFormulas, formula]);
                                                }
                                            }
                                        },
                                            React.createElement('div', {
                                                style: {
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '8px',
                                                    fontWeight: 'bold'
                                                }
                                            },
                                                React.createElement('span', null, typeIcons[formula.type || 'regular']),
                                                React.createElement('span', null, `${formula.id}: ${formula.name}`)
                                            ),
                                            React.createElement('div', {
                                                style: {
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '8px'
                                                }
                                            },
                                                React.createElement('span', {
                                                    style: {
                                                        cursor: 'pointer',
                                                        fontSize: '0.8em',
                                                        color: '#1890ff'
                                                    },
                                                    onClick: (e) => {
                                                        e.stopPropagation();
                                                        setExpandedFormula(isExpanded ? null : formula.id);
                                                    }
                                                }, isExpanded ? 'Masquer' : 'Détails'),
                                                React.createElement('div', {
                                                    style: {
                                                        width: '18px',
                                                        height: '18px',
                                                        borderRadius: '4px',
                                                        border: `1px solid ${isSelected ? '#1890ff' : '#d9d9d9'}`,
                                                        backgroundColor: isSelected ? '#1890ff' : 'white',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center'
                                                    }
                                                },
                                                    isSelected && React.createElement('span', {
                                                        style: { color: 'white', fontSize: '12px' }
                                                    }, '✓')
                                                )
                                            )
                                        ),
                                        isExpanded && React.createElement('div', {
                                            style: {
                                                padding: '0 12px 12px 12px',
                                                backgroundColor: 'white'
                                            }
                                        }, 
                                            renderExpertises(formula)
                                        )
                                    );
                                })
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Axes du brief'),
                            React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    flexWrap: 'wrap',
                                    gap: '8px',
                                    padding: '8px',
                                    background: '#f5f5f5',
                                    borderRadius: '8px'
                                }
                            },
                                [
                                    { label: '⚡ Performance', value: 'performance' },
                                    { label: '🌱 Green & Sécurisation', value: 'security' },
                                    { label: '💰 Coût', value: 'cost' },
                                    { label: '🎨 Couleur', value: 'color' }
                                ].map(priority => React.createElement(Tag.CheckableTag, {
                                    key: priority.value,
                                    checked: selectedPriorities.includes(priority.value),
                                    onChange: (checked) => {
                                        if (checked) {
                                            setSelectedPriorities([...selectedPriorities, priority.value]);
                                        } else {
                                            setSelectedPriorities(selectedPriorities.filter(p => p !== priority.value));
                                        }
                                    }
                                }, priority.label))
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', null, 'Décrivez votre objectif d\'analyse'),
                            React.createElement(Input.TextArea, {
                                rows: 4,
                                value: userProblem,
                                onChange: (e) => setUserProblem(e.target.value),
                                placeholder: 'Ex: Identifier les risques potentiels du projet au niveau des jalons techniques et planifier des actions préventives...'
                            })
                        ),
                        // Affichage de l'analyse de risque Excel si disponible
                        renderExcelAnalysis(),
                        
                        // Conserver l'affichage de la réponse AI existante
                        aiResponse && !showExcelAnalysis && React.createElement('div', {
                            style: {
                                marginTop: '16px',
                                padding: '16px',
                                background: '#f5f5f5',
                                borderRadius: '8px'
                            }
                        },
                            React.createElement('h4', null, 'Analyse des risques du projet'),
                            React.createElement('div', null, aiResponse)
                        )
                    )
                );
            };

            // AI Project Report Generator Dialog Component
            const AiProjectReportDrawer = ({ visible, onClose, briefData, milestones, formulas }) => {
                const [reportType, setReportType] = React.useState('progress');
                const [includeFormulas, setIncludeFormulas] = React.useState(true);
                const [includeBrief, setIncludeBrief] = React.useState(true);
                const [personalAnalysis, setPersonalAnalysis] = React.useState('');
                const [aiResponse, setAiResponse] = React.useState('');
                const [isTyping, setIsTyping] = React.useState(false);
                const [currentTypingIndex, setCurrentTypingIndex] = React.useState(0);
                const [showChatInterface, setShowChatInterface] = React.useState(false);
                const [userMessages, setUserMessages] = React.useState([]);
                const [aiMessages, setAiMessages] = React.useState([]);
                const [currentQuestion, setCurrentQuestion] = React.useState('');
                
                // Exemple de rapport pour démonstration
                const sampleReport = {
                    progress: `# Rapport d'avancement du projet Color Naturals
                    
## Résumé exécutif
Le projet de reformulation Color Naturals progresse conformément au planning prévu, avec 65% des jalons complétés. Les performances des formules sont globalement satisfaisantes, particulièrement sur les critères de sélectivité et d'intensité de coloration.

## Statut des jalons principaux
- **🔒 Safety**: 75% complété
  - AMM: Terminé ✓
  - Tolérance: En cours ⏳
- **🔬 Microbio**: 60% complété
  - Tests de culture: Terminé ✓
  - Stabilité: En cours ⏳
- **⚡ Performance**: 70% complété
  - Coloration: Terminé ✓
  - Soin: En cours ⏳

## Formules clés
La formule star FR2023-0056 démontre des résultats excellents sur tous les critères de performance et répond aux exigences de sécurité.

## Prochaines étapes
1. Finaliser les tests de tolérance cutanée d'ici le 25/04
2. Compléter l'analyse microbiologique des formules optimisées
3. Préparer la documentation pour la revue de synthèse prévue le 30/04`,

                    technical: `# Rapport technique du projet Color Naturals
                    
## Analyse de performance
Les formules développées présentent des avantages significatifs en termes de performance par rapport aux références de marché:
- Amélioration de la sélectivité: +18%
- Réduction du temps de pose: -20%
- Augmentation de la luminosité des nuances: +12%

## Expertises techniques
### 🔒 Safety
- **Tests réglementaires**: Les formules FR2023-0056 et FR2023-0063 ont passé avec succès l'ensemble des tests réglementaires
- **Tests de sensibilisation**: Les résultats montrent une diminution de 30% du potentiel sensibilisant

### 🔬 Microbio
- **Challenge tests**: Tous les tests ont été validés avec une marge de sécurité de 15%
- **Analyse des contaminants**: Aucun contaminant détecté au-delà des limites autorisées

## Défis techniques résolus
1. Stabilité des pigments oxydatifs dans la formule FR2023-0056
2. Compatibilité avec les conservateurs naturels
3. Optimisation du pH pour maximiser l'efficacité du système colorant

## Recommandations
- Privilégier la formule FR2023-0056 pour les nuances intenses
- Optimiser le procédé de fabrication pour réduire la variabilité entre lots`,

                    summary: `# Synthèse du projet Color Naturals
                    
## Contexte et objectifs
Le projet Color Naturals vise à développer une gamme de colorations plus respectueuses de l'environnement et offrant des performances supérieures en termes d'intensité et de durabilité.

## Points clés
- **Succès majeurs**: 
  - Réduction de 25% de l'impact environnemental
  - Amélioration de la sélectivité (+18%)
  - Excellents résultats de sécurité

- **Défis rencontrés**:
  - Stabilité à long terme des nuances claires
  - Variabilité des matières premières naturelles
  - Complexité des tests cliniques

## Impact business
- Économie potentielle de 0.8€/kg vs formule actuelle
- Positionnement compétitif renforcé sur le segment premium
- Possibilité d'extension de la gamme à 15 nuances supplémentaires

## Conclusion et perspectives
Le projet a démontré qu'il est possible de concilier naturalité, performance et sécurité dans une formule de coloration. La technologie développée ouvre la voie à une nouvelle génération de produits plus durables.`
                };

                React.useEffect(() => {
                    if (visible) {
                        // Réinitialiser l'interface lors de l'ouverture
                        setAiResponse('');
                        setIsTyping(false);
                        setCurrentTypingIndex(0);
                        setShowChatInterface(false);
                        setUserMessages([]);
                        setAiMessages([]);
                    }
                }, [visible]);

                const handleSubmit = () => {
                    // Afficher l'interface de chat
                    setShowChatInterface(true);
                    
                    // Simuler le début de la génération
                    setAiResponse('');
                    setIsTyping(true);
                    setCurrentTypingIndex(0);
                    
                    // Récupérer le rapport exemple selon le type
                    const reportContent = sampleReport[reportType];
                    
                    // Simuler la génération progressive du texte
                    let index = 0;
                    const typingInterval = setInterval(() => {
                        if (index < reportContent.length) {
                            setAiResponse(prevResponse => prevResponse + reportContent.charAt(index));
                            index++;
                            setCurrentTypingIndex(index);
                        } else {
                            clearInterval(typingInterval);
                            setIsTyping(false);
                            
                            // Ajouter le rapport aux messages AI
                            setAiMessages([{
                                type: 'report',
                                content: reportContent
                            }]);
                        }
                    }, 10); // Vitesse d'écriture
                    
                    return () => clearInterval(typingInterval);
                };
                
                const handleSendQuestion = () => {
                    if (!currentQuestion.trim()) return;
                    
                    // Ajouter la question aux messages de l'utilisateur
                    const newUserMessages = [...userMessages, {
                        content: currentQuestion
                    }];
                    setUserMessages(newUserMessages);
                    
                    // Simuler une réponse AI
                    setTimeout(() => {
                        let aiResponse = '';
                        if (currentQuestion.toLowerCase().includes('performance')) {
                            aiResponse = "Les performances des formules sont excellentes, notamment sur les critères de sélectivité et d'intensité. La formule FR2023-0056 surpasse les attentes avec un score de 4.2/5 pour la rétention de couleur.";
                        } else if (currentQuestion.toLowerCase().includes('sécurité') || currentQuestion.toLowerCase().includes('securite')) {
                            aiResponse = "Tous les tests de sécurité ont été validés. Les formules présentent une excellente tolérance cutanée et une réduction significative du potentiel sensibilisant par rapport aux formulations actuelles.";
                        } else if (currentQuestion.toLowerCase().includes('coût') || currentQuestion.toLowerCase().includes('cout')) {
                            aiResponse = "L'optimisation des formules a permis une réduction des coûts de 0.8€/kg en moyenne, tout en améliorant les performances. Le coût actuel est inférieur de 12% à l'objectif fixé dans le brief.";
                        } else {
                            aiResponse = "Votre question est pertinente. D'après l'analyse des données du projet, " + 
                                "les résultats sont encourageants et alignés avec les objectifs initiaux. " +
                                "Souhaitez-vous des détails spécifiques sur un aspect particulier du projet ?";
                        }
                        
                        setAiMessages([...aiMessages, {
                            type: 'response',
                            content: aiResponse
                        }]);
                        
                        setCurrentQuestion('');
                    }, 1500);
                };

                // Rendu de l'interface de chat
                const renderChatInterface = () => {
                    return React.createElement('div', {
                        style: {
                            display: 'flex',
                            flexDirection: 'column',
                            height: '100%',
                            width: '100%',
                            padding: '0'
                        }
                    },
                        // Zone de rapport
                        React.createElement('div', {
                            style: {
                                flex: 1,
                                overflowY: 'auto',
                                padding: '16px',
                                backgroundColor: 'white',
                                borderRadius: '8px',
                                marginBottom: '16px'
                            }
                        },
                            // Afficher le rapport en cours de génération
                            isTyping ? 
                                React.createElement('div', {
                                    style: {
                                        whiteSpace: 'pre-wrap',
                                        fontFamily: 'monospace',
                                        fontSize: '14px',
                                        lineHeight: '1.5'
                                    }
                                }, 
                                    aiResponse,
                                    React.createElement('span', {
                                        style: {
                                            display: 'inline-block',
                                            width: '8px',
                                            height: '16px',
                                            backgroundColor: '#1890ff',
                                            animation: 'blink 1s infinite',
                                            verticalAlign: 'middle'
                                        }
                                    })
                                ) :
                                // Afficher l'historique des messages
                                React.createElement(React.Fragment, null,
                                    aiMessages.length > 0 && aiMessages[0].type === 'report' &&
                                        React.createElement('div', { 
                                            style: { position: 'relative' }
                                        },
                                            // Bouton de téléchargement
                                            React.createElement('div', {
                                                style: {
                                                    position: 'absolute',
                                                    top: '12px',
                                                    right: '12px',
                                                    zIndex: 10
                                                }
                                            },
                                                React.createElement(Button, {
                                                    type: 'primary',
                                                    icon: '📥',
                                                    size: 'small',
                                                    style: {
                                                        background: '#52c41a',
                                                        borderColor: '#52c41a'
                                                    },
                                                    onClick: (e) => {
                                                        e.stopPropagation();
                                                        
                                                        // Créer un blob avec le contenu du rapport
                                                        const reportContent = aiMessages[0].content;
                                                        const blob = new Blob([reportContent], { type: 'text/markdown' });
                                                        
                                                        // Créer un URL pour le blob
                                                        const url = URL.createObjectURL(blob);
                                                        
                                                        // Créer un élément a temporaire et simuler un clic
                                                        const a = document.createElement('a');
                                                        a.href = url;
                                                        a.download = `Rapport_${reportType}_${new Date().toISOString().slice(0, 10)}.md`;
                                                        document.body.appendChild(a);
                                                        a.click();
                                                        
                                                        // Nettoyer
                                                        setTimeout(() => {
                                                            document.body.removeChild(a);
                                                            URL.revokeObjectURL(url);
                                                        }, 0);
                                                    }
                                                }, 'Télécharger')
                                            ),
                                            React.createElement('div', {
                                                style: {
                                                    whiteSpace: 'pre-wrap',
                                                    fontFamily: 'monospace',
                                                    fontSize: '14px',
                                                    lineHeight: '1.5',
                                                    marginBottom: '20px',
                                                    padding: '16px',
                                                    backgroundColor: '#f9f9f9',
                                                    borderRadius: '8px',
                                                    border: '1px solid #e8e8e8'
                                                }
                                            }, aiMessages[0].content)
                                        ),
                                    
                                    // Afficher les conversations
                                    userMessages.map((msg, i) => 
                                        React.createElement('div', {
                                            key: `user-${i}`,
                                            style: {
                                                marginBottom: '16px',
                                                display: 'flex',
                                                flexDirection: 'column'
                                            }
                                        },
                                            React.createElement('div', {
                                                style: {
                                                    alignSelf: 'flex-end',
                                                    backgroundColor: '#1890ff',
                                                    color: 'white',
                                                    padding: '8px 12px',
                                                    borderRadius: '16px 16px 0 16px',
                                                    maxWidth: '80%'
                                                }
                                            }, msg.content),
                                            aiMessages[i+1] && 
                                                React.createElement('div', {
                                                    style: {
                                                        alignSelf: 'flex-start',
                                                        backgroundColor: '#f0f0f0',
                                                        padding: '8px 12px',
                                                        borderRadius: '16px 16px 16px 0',
                                                        maxWidth: '80%',
                                                        marginTop: '8px'
                                                    }
                                                }, aiMessages[i+1].content)
                                        )
                                    )
                                )
                        ),
                        
                        // Barre d'entrée pour poser des questions
                        !isTyping && React.createElement('div', {
                            style: {
                                display: 'flex',
                                gap: '8px',
                                padding: '8px',
                                backgroundColor: '#f5f5f5',
                                borderRadius: '8px'
                            }
                        },
                            React.createElement(Input, {
                                placeholder: 'Posez une question sur le rapport...',
                                value: currentQuestion,
                                onChange: (e) => setCurrentQuestion(e.target.value),
                                onPressEnter: handleSendQuestion,
                                style: { flex: 1 }
                            }),
                            React.createElement(Button, {
                                type: 'primary',
                                onClick: handleSendQuestion
                            }, 'Envoyer')
                        )
                    );
                };

                return React.createElement(Drawer, {
                    title: '📊 Générer un rapport de projet',
                    placement: 'right',
                    width: 700,
                    onClose: onClose,
                    open: visible,
                    bodyStyle: { 
                        padding: '20px',
                        height: showChatInterface ? 'calc(100% - 55px)' : 'auto',
                        overflow: 'hidden' 
                    },
                    extra: showChatInterface ? 
                        React.createElement(Button, {
                            onClick: () => {
                                setShowChatInterface(false);
                                setAiResponse('');
                            }
                        }, 'Retour aux options') :
                        React.createElement(Button, {
                            type: 'primary',
                            onClick: handleSubmit
                        }, 'Générer')
                },
                    showChatInterface ? 
                        renderChatInterface() :
                        React.createElement('div', {
                            style: {
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '24px'
                            }
                        },
                            React.createElement('div', null,
                                React.createElement('h4', null, 'Type de rapport'),
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        flexDirection: 'column',
                                        gap: '12px'
                                    }
                                },
                                    [
                                        {
                                            value: 'progress',
                                            title: 'Rapport d\'avancement',
                                            description: 'Focus sur le statut des jalons et les prochaines étapes'
                                        },
                                        {
                                            value: 'technical',
                                            title: 'Rapport technique',
                                            description: 'Focus sur les performances des formules et les résultats d\'expertise'
                                        },
                                        {
                                            value: 'summary',
                                            title: 'Rapport de synthèse',
                                            description: 'Résumé global du projet avec points clés'
                                        }
                                    ].map(option => 
                                        React.createElement('div', {
                                            key: option.value,
                                            style: {
                                                display: 'flex',
                                                alignItems: 'flex-start',
                                                padding: '8px 12px',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                backgroundColor: reportType === option.value ? '#f0f7ff' : 'transparent',
                                                border: reportType === option.value ? '1px solid #1890ff' : '1px solid transparent'
                                            },
                                            onClick: () => setReportType(option.value)
                                        },
                                            React.createElement('div', {
                                                style: {
                                                    width: '20px',
                                                    height: '20px',
                                                    borderRadius: '50%',
                                                    border: '1px solid #d9d9d9',
                                                    marginRight: '8px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    backgroundColor: reportType === option.value ? '#1890ff' : 'white'
                                                }
                                            },
                                                reportType === option.value && React.createElement('div', {
                                                    style: {
                                                        width: '10px',
                                                        height: '10px',
                                                        borderRadius: '50%',
                                                        backgroundColor: 'white'
                                                    }
                                                })
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('strong', null, option.title),
                                                React.createElement('div', { 
                                                    style: { fontSize: '0.9em', color: '#666' } 
                                                }, option.description)
                                            )
                                        )
                                    )
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('h4', null, 'Options de contenu'),
                                React.createElement('div', {
                                    style: {
                                        display: 'flex',
                                        flexDirection: 'column',
                                        gap: '12px'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            alignItems: 'center',
                                            cursor: 'pointer'
                                        },
                                        onClick: () => setIncludeFormulas(!includeFormulas)
                                    },
                                        React.createElement('div', {
                                            style: {
                                                width: '16px',
                                                height: '16px',
                                                border: '1px solid #d9d9d9',
                                                borderRadius: '2px',
                                                marginRight: '8px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                backgroundColor: includeFormulas ? '#1890ff' : 'white'
                                            }
                                        },
                                            includeFormulas && React.createElement('span', {
                                                style: { color: 'white', fontSize: '12px' }
                                            }, '✓')
                                        ),
                                        React.createElement('span', null, 'Inclure détails des formules')
                                    ),
                                    React.createElement('div', {
                                        style: {
                                            display: 'flex',
                                            alignItems: 'center',
                                            cursor: 'pointer'
                                        },
                                        onClick: () => setIncludeBrief(!includeBrief)
                                    },
                                        React.createElement('div', {
                                            style: {
                                                width: '16px',
                                                height: '16px',
                                                border: '1px solid #d9d9d9',
                                                borderRadius: '2px',
                                                marginRight: '8px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                backgroundColor: includeBrief ? '#1890ff' : 'white'
                                            }
                                        },
                                            includeBrief && React.createElement('span', {
                                                style: { color: 'white', fontSize: '12px' }
                                            }, '✓')
                                        ),
                                        React.createElement('span', null, 'Inclure informations du brief')
                                    )
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('h4', null, 'Analyse personnelle'),
                                React.createElement('div', {
                                    style: {
                                        marginBottom: '8px',
                                        fontSize: '0.9em',
                                        color: '#666'
                                    }
                                }, 'Ajoutez vos propres observations ou commentaires à inclure dans le rapport'),
                                React.createElement(Input.TextArea, {
                                    rows: 4,
                                    value: personalAnalysis,
                                    onChange: (e) => setPersonalAnalysis(e.target.value),
                                    placeholder: 'Ex: Notez que la formule FR2023-0056 présente des avantages significatifs en termes de coût et de performance, ce qui en fait un candidat idéal pour le lancement prioritaire...'
                                })
                            )
                        )
                );
            };

            return React.createElement('div', { className: 'container' },
                React.createElement('div', { className: 'sidebar' },
                    sidebarItems.map(item => 
                        React.createElement(SidebarItem, {
                            key: item.label,
                            ...item,
                            active: item.label === 'Expertise'
                        })
                    )
                ),
                React.createElement('div', { className: 'main-content' },
                    React.createElement(MainHeader),
                    React.createElement('div', { className: 'breadcrumb' },
                        React.createElement(Breadcrumb, {
                            items: [
                                { title: '🏠 Project page' },
                                { title: 'Overview' }
                            ]
                        })
                    ),
                    React.createElement('div', { className: 'content-area' },
                        React.createElement('div', { className: 'grid-layout' },
                            React.createElement(ContentSection, {
                                title: 'Infos du sous-projet',
                                action: React.createElement(Space, {
                                    size: 'middle'
                                },
                                    React.createElement(Button, {
                                        type: 'primary',
                                        style: { backgroundColor: 'var(--primary-color)' }
                                    }, 'Voir Orchestra'),
                                    React.createElement(Button, {
                                        type: 'primary',
                                        style: { backgroundColor: 'var(--primary-color)' }
                                    }, 'Voir Magellan')
                                )
                            },
                                React.createElement('div', {
                                    style: {
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(4, 1fr)',
                                        gap: '16px'
                                    }
                                },
                                    // Première ligne
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Objectif principal:'),
                                        React.createElement('div', null, 'Amélioration formule')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Complexité R&I (MAJ):'),
                                        React.createElement('div', null, 'Moyenne')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Entité / Labo:'),
                                        React.createElement('div', null, 'Paris / Lab-3')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Statut:'),
                                        React.createElement(Tag, { color: 'processing' }, 'En cours')
                                    ),
                                    // Deuxième ligne
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Division'),
                                        React.createElement('div', null, 'Cosmétique')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Marque'),
                                        React.createElement('div', null, 'Garnier')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Franchise'),
                                        React.createElement('div', null, 'Color Naturals')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Métier'),
                                        React.createElement('div', null, 'Coloration')
                                    ),
                                    // Troisième ligne
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Sous-métier'),
                                        React.createElement('div', null, 'Permanent')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Type de produit'),
                                        React.createElement('div', null, 'Crème colorante')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Responsable'),
                                        React.createElement('div', null, 'BACLET Jérôme')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { color: '#666', fontSize: '0.9em' } }, 'Contributeurs'),
                                        React.createElement('div', null, 'DUPONT Marie')
                                    )
                                )
                            ),
                            React.createElement(ContentSection, {
                                title: 'Brief',
                                action: 'Éditer'
                            },
                                React.createElement(BriefContent)
                            )
                        ),
                        React.createElement(ContentSection, {
                            title: 'Checklist',
                            action: React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    gap: '16px',
                                    alignItems: 'center'
                                }
                            },
                                React.createElement(Dropdown, {
                                    overlay: React.createElement(Menu, {
                                        items: [
                                            {
                                                key: 'project-risk',
                                                label: '🔍 Analyse des risques projet',
                                                onClick: () => setAiProjectRiskAnalysisDrawerVisible(true)
                                            },
                                            {
                                                key: 'project-report',
                                                label: '📊 Générer un rapport',
                                                onClick: () => setAiProjectReportDrawerVisible(true)
                                            }
                                        ]
                                    }),
                                    trigger: ['click']
                                },
                                    React.createElement(Button, {
                                        icon: '🤖'
                                    }, 'Assistants IA')
                                ),
                                React.createElement(Select, {
                                placeholder: 'Gérer les templates',
                                style: { width: 280 },
                                options: templateOptions,
                                onChange: handleTemplateChange,
                                dropdownStyle: { padding: '8px 0' },
                                bordered: true,
                                className: 'template-select'
                                })
                            ),
                            type: 'no-action-style'
                        },
                            React.createElement(ChecklistView, { 
                                data: initialData,
                                            onCommentClick: handleCommentClick,
                                            onItemClick: handleItemClick,
                                            selectedItem: selectedItem
                            })
                        ),
                        selectedItem && selectedItem.subMilestones && React.createElement(ContentSection, {
                            title: React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }
                            },
                                React.createElement('span', {
                                    style: {
                                        cursor: 'pointer',
                                        padding: '4px',
                                        borderRadius: '4px',
                                        color: 'var(--primary-color)',
                                        display: 'inline-flex',
                                        alignItems: 'center'
                                    },
                                    onClick: () => handleItemClick(null)
                                }, '▲'),
                                `Sous-jalons - ${selectedItem.title}`
                            ),
                            action: React.createElement('div', {
                                style: {
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '16px'
                                }
                            },
                                selectedItem.conclusion && React.createElement(Tag, {
                                    style: {
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px',
                                        padding: '4px 8px',
                                        height: 'auto',
                                        fontSize: '0.9em'
                                    },
                                    color: selectedItem.conclusion.status === 'OK' ? 'success' :
                                           selectedItem.conclusion.status === 'KO' ? 'error' :
                                           'warning'
                                },
                                    React.createElement('span', {
                                        style: {
                                            fontWeight: 'bold'
                                        }
                                    }, selectedItem.conclusion.status),
                                    React.createElement('span', null, selectedItem.conclusion.comment)
                                ),
                                React.createElement(Space, null,
                                    React.createElement(Button, {
                                        type: 'primary',
                                        onClick: () => {
                                            setSelectedMilestone(selectedItem);
                                            setConcludeDrawerVisible(true);
                                        }
                                    }, 'Conclure'),
                                    React.createElement(Button, {
                                onClick: () => setSubMilestoneDrawerVisible(true),
                                icon: '⚙️'
                            }, 'Gérer')
                                )
                            )
                        },
                            React.createElement('div', null,
                                selectedItem.subMilestones.map(milestone =>
                                    React.createElement(SubMilestoneCard, { 
                                        key: milestone.id,
                                        milestone: milestone,
                                        onCommentClick: (item) => handleCommentClick({
                                            ...item,
                                            parentTitle: selectedItem.title
                                        })
                                    })
                                )
                            )
                        ),
                        React.createElement(ContentSection, {
                            title: 'Formules associées',
                            action: React.createElement(Space, {
                                size: 'middle'
                            },
                                React.createElement(Select, {
                                    placeholder: 'Filtrer par nuance',
                                    style: { width: 160 },
                                    allowClear: true,
                                    options: [
                                        { label: '2.0 - Brun noir', value: '2.0' },
                                        { label: '2.23 - Brun irisé', value: '2.23' },
                                        { label: '2.4 - Brun cuivré', value: '2.4' },
                                        { label: '3.0 - Châtain foncé', value: '3.0' },
                                        { label: '3.23 - Châtain irisé', value: '3.23' },
                                        { label: '4.0 - Châtain', value: '4.0' },
                                        { label: '4.15 - Châtain cendré', value: '4.15' },
                                        { label: '5.0 - Châtain clair', value: '5.0' }
                                    ]
                                }),
                                React.createElement(Select, {
                                    placeholder: 'Filtrer par expertise',
                                    style: { width: 200 },
                                    allowClear: true,
                                    options: [
                                        {
                                            label: 'Safety',
                                            options: [
                                                { label: '5DA', value: 'safety-5da' },
                                                { label: 'AMM', value: 'safety-amm' },
                                                { label: 'Tests sécurité', value: 'safety-tests' }
                                            ]
                                        },
                                        {
                                            label: 'Microbio',
                                            options: [
                                                { label: 'Culture', value: 'microbio-cult' },
                                                { label: 'Contamination', value: 'microbio-cont' },
                                                { label: 'Stabilité', value: 'microbio-stab' }
                                            ]
                                        },
                                        {
                                            label: 'Performance',
                                            options: [
                                                { label: 'Color retention', value: 'perf-color' },
                                                { label: 'Selectivity', value: 'perf-select' }
                                            ]
                                        }
                                    ]
                                }),
                                React.createElement(Select, {
                                    placeholder: 'Filtrer par critère',
                                    style: { width: 200 },
                                    allowClear: true,
                                    options: [
                                        {
                                            label: 'Performance',
                                            options: [
                                                { label: 'Color retention > 3/4', value: 'color-high' },
                                                { label: 'Selectivity > 3/4', value: 'select-high' }
                                            ]
                                        },
                                        {
                                            label: 'Green & Sécurisation',
                                            options: [
                                                { label: 'Sans microplastique', value: 'no-micro' },
                                                { label: 'Biodégradable > 90%', value: 'bio-90' }
                                            ]
                                        },
                                        {
                                            label: 'Coût',
                                            options: [
                                                { label: 'Prix < 1.2€/kg', value: 'cost-target' }
                                            ]
                                        }
                                    ]
                                }),
                                React.createElement(Button, {
                                    type: 'primary'
                                }, 'Ajouter')
                            )
                        },
                            React.createElement('div', { 
                                className: 'formulas-container'
                            },
                                formulas.map(formula =>
                                    React.createElement(FormulaCard, {
                                        key: formula.id,
                                        formula: formula,
                                        onPin: handlePinFormula,
                                        onCommentClick: handleCommentClick,
                                        milestones: data,
                                        pinnedTo: getPinnedMilestones(formula.id),
                                        starFormulas: starFormulas,
                                        onStarClick: handleSetStarFormula,
                                        isSelected: selectedFormulas.has(formula.id),
                                        onSelect: handleFormulaSelect
                                    })
                                )
                            ),
                            React.createElement(ActionsBar)
                        )
                    ),
                    React.createElement(CommentDrawer, {
                        visible: drawerVisible,
                        onClose: () => {
                            setDrawerVisible(false);
                            setIsPinning(false);
                            setFormulaToPinData(null);
                        },
                        item: selectedItem,
                        isPinning: isPinning,
                        onConfirm: handlePinConfirm
                    }),
                    React.createElement(TemplateDrawer, {
                        visible: templateDrawerVisible,
                        onClose: () => setTemplateDrawerVisible(false),
                        data: data,
                        onSave: handleTemplateSave
                    }),
                    React.createElement(SubMilestoneDrawer, {
                        visible: subMilestoneDrawerVisible,
                        onClose: () => setSubMilestoneDrawerVisible(false),
                        milestone: selectedItem
                    }),
                    React.createElement(ConcludeExpertiseDrawer, {
                        visible: concludeDrawerVisible,
                        onClose: () => setConcludeDrawerVisible(false),
                        milestone: selectedMilestone,
                        onSubmit: handleConcludeSubmit
                    }),
                    React.createElement(AiStrategyDrawer, {
                        visible: aiStrategyDrawerVisible,
                        onClose: () => setAiStrategyDrawerVisible(false),
                        formulas: Array.from(selectedFormulas).map(id => formulas.find(f => f.id === id)),
                        briefData: briefData
                    }),
                    React.createElement(AiStartingPointDrawer, {
                        visible: aiStartingPointDrawerVisible,
                        onClose: () => setAiStartingPointDrawerVisible(false),
                        formulas: formulas,
                        briefData: briefData
                    }),
                    React.createElement(AiRiskAnalysisDrawer, {
                        visible: aiRiskAnalysisDrawerVisible,
                        onClose: () => setAiRiskAnalysisDrawerVisible(false),
                        formulas: formulas,
                        briefData: briefData
                    }),
                    React.createElement(AiProjectRiskAnalysisDrawer, {
                        visible: aiProjectRiskAnalysisDrawerVisible,
                        onClose: () => setAiProjectRiskAnalysisDrawerVisible(false),
                        briefData: briefData,
                        milestones: data,
                        formulas: formulas
                    }),
                    React.createElement(AiProjectReportDrawer, {
                        visible: aiProjectReportDrawerVisible,
                        onClose: () => setAiProjectReportDrawerVisible(false),
                        briefData: briefData,
                        milestones: data,
                        formulas: formulas
                    })
                )
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html> 